

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Virtual Interrupt &mdash; Project ACRN™ v 0.7-unstable documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/ACRN-favicon-32x32.png"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/acrn-custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="VT-d" href="hv-vt-d.html" />
    <link rel="prev" title="Timer" href="hv-timer.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Project ACRN™
          

          
            
            <img src="../../_static/ACRN_Logo_200w.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction to Project ACRN</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#automotive-use-case-example">Automotive Use Case Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#licensing">Licensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#acrn-device-model-service-os-and-user-os">ACRN Device Model, Service OS, and User OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#boot-sequence">Boot Sequence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#acrn-hypervisor-architecture">ACRN Hypervisor Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#acrn-device-model-architecture">ACRN Device Model Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#device-pass-through">Device pass through</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../introduction/index.html#hardware-support-for-device-passthrough">Hardware support for device passthrough</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../introduction/index.html#hypervisor-support-for-device-passthrough">Hypervisor support for device passthrough</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#acrn-i-o-mediator">ACRN I/O mediator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#virtio-framework-architecture">Virtio framework architecture</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting Started Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/apl-nuc.html">Getting started guide for Intel NUC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/apl-nuc.html#hardware-setup">Hardware setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting-started/apl-nuc.html#firmware-update-on-the-nuc">Firmware update on the NUC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/apl-nuc.html#software-setup">Software setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting-started/apl-nuc.html#set-up-a-clear-linux-operating-system">Set up a Clear Linux Operating System</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting-started/apl-nuc.html#add-the-acrn-hypervisor-to-the-efi-partition">Add the ACRN hypervisor to the EFI Partition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting-started/apl-nuc.html#acrn-network-bridge">ACRN Network Bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting-started/apl-nuc.html#set-up-reference-uos">Set up Reference UOS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/up2.html">Getting started guide for UP2 board</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/up2.html#hardware-setup">Hardware setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting-started/up2.html#connecting-to-the-serial-port">Connecting to the serial port</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/up2.html#software-setup">Software setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting-started/up2.html#up2-serial-port-setting">UP2 serial port setting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting-started/up2.html#up2-block-device">UP2 block device</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/up2.html#running-the-hypervisor">Running the hypervisor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/building-from-source.html">Build ACRN from Source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/building-from-source.html#install-build-tools-and-dependencies">Install build tools and dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/building-from-source.html#build-the-hypervisor-device-model-and-tools">Build the hypervisor, device model and tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/building-from-source.html#configuring-the-hypervisor">Configuring the hypervisor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/building-from-source.html#modify-the-hypervisor-configurations">Modify the hypervisor configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/building-from-source.html#create-a-new-default-configuration">Create a new default configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware.html">Supported Hardware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../hardware.html#intel-apollo-lake-nuc">Intel Apollo Lake NUC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware.html#intel-kaby-lake-nuc">Intel Kaby Lake NUC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware.html#up-squared-board">UP Squared board</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guides/index.html">User Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user-guides/acrn-dm-parameters.html">Device Model Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user-guides/acrn-shell.html">ACRN Shell Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user-guides/tools.html">Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tools/README.html">ACRN tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tools/acrn-crashlog/README.html">ACRN-Crashlog</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/README.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/README.html#building">Building</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/README.html#installing">Installing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/README.html#enabling-disabling">Enabling/Disabling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/README.html#source-code">Source Code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/README.html">acrnprobe</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/README.html#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/README.html#source-files">Source files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/README.html#configuration-files">Configuration files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/conf.html">acrnprobe Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/conf.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/conf.html#layout">Layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/conf.html#properties-of-group-members">Properties of group members</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/conf.html#crash-tree-in-acrnprobe">Crash tree in acrnprobe</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/acrnprobe/conf.html#sections">Sections</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools/acrn-crashlog/usercrash/README.html">usercrash</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/usercrash/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/usercrash/README.html#design">Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/usercrash/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-crashlog/usercrash/README.html#souce-code">Souce Code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools/acrn-manager/README.html">acrnctl and acrnd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-manager/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-manager/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-manager/README.html#acrnd">acrnd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrn-manager/README.html#build-and-install">Build and Install</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools/acrnlog/README.html">acrnlog</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrnlog/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrnlog/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrnlog/README.html#build-and-install">Build and Install</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools/acrntrace/README.html">acrntrace</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrntrace/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrntrace/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools/acrntrace/README.html#build-and-install">Build and Install</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">High-Level Design Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="hld-overview.html">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hld-overview.html#acrn-supported-use-cases">ACRN Supported Use Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-overview.html#hardware-requirements">Hardware Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-overview.html#acrn-architecture">ACRN Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-overview.html#hypervisor">Hypervisor</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-overview.html#sos">SOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-overview.html#uos">UOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-overview.html#freedom-from-interference">Freedom From Interference</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-overview.html#boot-flow">Boot Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-overview.html#power-management">Power Management</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="reference internal" href="hld-hypervisor.html">Hypervisor</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="hv-startup.html">Hypervisor Startup</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-cpu-virt.html">CPU Virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-memmgt.html">Memory management</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-io-emulation.html">I/O Emulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-ioc-virt.html">IOC Virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-interrupt.html">Physical Interrupt</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-timer.html">Timer</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Virtual Interrupt</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-vt-d.html">VT-d</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-dev-passthrough.html">Device Passthrough</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-partitionmode.html">Partition mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-pm.html">Power Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-console.html">Console, Shell, and vUART</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-hypercall.html">Hypercall / VHM upcall</a></li>
<li class="toctree-l4"><a class="reference internal" href="hv-config.html">Compile-time configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hld-devicemodel.html">Device Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hld-devicemodel.html#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-devicemodel.html#dm-initialization">DM Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-devicemodel.html#vhm">VHM</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-devicemodel.html#i-o-emulation-in-sos">I/O Emulation in SOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-devicemodel.html#device-emulation">Device Emulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-devicemodel.html#isa-and-pci-emulation">ISA and PCI Emulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-devicemodel.html#acpi-virtualization">ACPI Virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-devicemodel.html#pm-in-device-model">PM in Device Model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hld-emulated-devices.html">Emulated Devices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="usb-virt-hld.html">USB Virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="uart-virt-hld.html">UART virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="watchdog-hld.html">Watchdoc virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="random-virt-hld.html">Random device virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-APL_GVT-g.html">GVT-g GPU Virtualization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hld-virtio-devices.html">Virtio Devices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hld-virtio-devices.html#virtio-introduction">Virtio introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-virtio-devices.html#key-concepts">Key Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-virtio-devices.html#virtio-frameworks">Virtio Frameworks</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-virtio-devices.html#virtio-apis">Virtio APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-virtio-devices.html#supported-virtio-devices">Supported Virtio Devices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hld-vm-management.html">VM Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hld-vm-management.html#vm-state">VM state</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-vm-management.html#scenarios-of-vm-state-change">Scenarios of VM state change</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-vm-management.html#vm-state-management">VM State management</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hld-power-management.html">Power Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hld-power-management.html#p-state-c-state-management">P-state/C-state management</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-power-management.html#s3-s5">S3/S5</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hld-trace-log.html">Tracing and Logging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hld-trace-log.html#shared-buffer">Shared Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-trace-log.html#acrn-trace">ACRN Trace</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-trace-log.html#acrn-log">ACRN Log</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hld-vsbl.html">Virtual Bootloader</a></li>
<li class="toctree-l3"><a class="reference internal" href="hld-security.html">Security</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hld-security.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-security.html#background">Background</a></li>
<li class="toctree-l4"><a class="reference internal" href="hld-security.html#acrn-high-level-security-architecture">ACRN High-Level Security Architecture</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../primer.html">Developer Primer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#source-tree-structure">Source Tree Structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#acrn-hypervisor-source-tree">ACRN hypervisor source tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#acrn-device-model-source-tree">ACRN Device Model source tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#acrn-tools-source-tree">ACRN Tools source tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#acrn-documentation-source-tree">ACRN documentation source tree</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#cpu-virtualization">CPU virtualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#host-gdt">Host GDT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#host-idt">Host IDT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#guest-smp-booting">Guest SMP Booting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#vmx-configuration">VMX configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#cpuid-and-guest-tsc-calibration">CPUID and Guest TSC calibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#rdtsc-rdtscp">RDTSC/RDTSCP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#cr-register-virtualization">CR Register virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#msr-bitmap">MSR BITMAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#i-o-bitmap">I/O BITMAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#exceptions">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#memory-virtualization">Memory virtualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#physical-memory-layout">Physical Memory Layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#pv-mmu-memory-mapping-in-the-hypervisor">PV (MMU) Memory Mapping in the Hypervisor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#pv-mmu-memory-mapping-in-vms">PV (MMU) Memory Mapping in VMs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#host-guest-ept-memory-mapping">Host-Guest (EPT) Memory Mapping</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#graphic-mediation">Graphic mediation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#i-o-emulation">I/O emulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#device-assignment-management">Device Assignment Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#pio-mmio-trap-flow">PIO/MMIO trap Flow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#virtual-interrupt">Virtual interrupt</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#virtual-lapic">Virtual LAPIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#virtual-ioapic">Virtual IOAPIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#virtual-pic">Virtual PIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#virtual-interrupt-injection">Virtual Interrupt Injection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#vt-x-and-vt-d">VT-x and VT-d</a></li>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#hypercall">Hypercall</a></li>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#device-emulation">Device emulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../primer.html#virtio-devices">Virtio Devices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#virtio-rnd">Virtio-rnd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#virtio-blk">Virtio-blk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#virtio-net">Virtio-net</a></li>
<li class="toctree-l4"><a class="reference internal" href="../primer.html#virtio-console">Virtio-console</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../GVT-g-porting.html">GVT-g Enabling and Porting Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-porting.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-porting.html#purpose-of-this-document">Purpose of this document</a></li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-porting.html#overall-components">Overall Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-porting.html#core-scenario-interaction-sequences">Core scenario interaction sequences</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-porting.html#vgpu-creation-scenario">vGPU creation scenario</a></li>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-porting.html#vgpu-destroy-scenario">vGPU destroy scenario</a></li>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-porting.html#vgpu-pci-configure-space-write-scenario">vGPU pci configure space write scenario</a></li>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-porting.html#pci-configure-space-read-scenario">pci configure space read scenario</a></li>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-porting.html#ggtt-read-write-scenario">GGTT read/write scenario</a></li>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-porting.html#mmio-read-write-scenario">MMIO read/write scenario</a></li>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-porting.html#ppgtt-write-protection-page-set-unset-scenario">PPGTT write protection page set/unset scenario</a></li>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-porting.html#ppgtt-write-protection-page-write">PPGTT write protection page write</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-porting.html#api-details">API details</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../GVT-g-kernel-options.html">GVT-g (AcrnGT) Kernel Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-kernel-options.html#i915-enable-gvt">i915.enable_gvt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-kernel-options.html#i915-enable-pvmmio">i915.enable_pvmmio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-kernel-options.html#i915-gvt-workload-priority">i915.gvt_workload_priority</a></li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-kernel-options.html#i915-enable-initial-modeset">i915.enable_initial_modeset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-kernel-options.html#i915-avail-planes-per-pipe-and-i915-domain-plane-owners">i915.avail_planes_per_pipe and i915.domain_plane_owners</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-kernel-options.html#i915-domain-plane-owners">i915.domain_plane_owners</a></li>
<li class="toctree-l4"><a class="reference internal" href="../GVT-g-kernel-options.html#i915-avail-planes-per-pipe">i915.avail_planes_per_pipe</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-kernel-options.html#i915-domain-scaler-owner">i915.domain_scaler_owner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../GVT-g-kernel-options.html#i915-enable-hangcheck">i915.enable_hangcheck</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../trusty.html">Trusty TEE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trusty.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trusty.html#trusty-architecture">Trusty Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trusty.html#trusty-specific-hypercalls">Trusty specific Hypercalls</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trusty.html#trusty-boot-flow">Trusty Boot flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trusty.html#ept-hierarchy">EPT Hierarchy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../trusty.html#design">Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trusty.html#benefit">Benefit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../trusty.html#api">API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../l1tf.html">L1 Terminal Fault Mitigation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../l1tf.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../l1tf.html#l1tf-problem-in-acrn">L1TF Problem in ACRN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../l1tf.html#guest-hypervisor-attack">Guest -&gt; hypervisor Attack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../l1tf.html#guest-guest-attack">Guest -&gt; guest Attack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../l1tf.html#normal-world-secure-world-attack">Normal_world -&gt; Secure_world Attack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../l1tf.html#affected-processors">Affected Processors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../l1tf.html#l1tf-mitigation-in-acrn">L1TF Mitigation in ACRN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../l1tf.html#l1d-flush-on-vmentry">L1D flush on VMENTRY</a></li>
<li class="toctree-l4"><a class="reference internal" href="../l1tf.html#ept-sanitization">EPT Sanitization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../l1tf.html#put-secret-data-into-uncached-memory">Put Secret Data into Uncached Memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../l1tf.html#l1d-flush-on-world-switch">L1D flush on World Switch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../l1tf.html#core-based-scheduling">Core-based scheduling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../l1tf.html#mitigation-recommendations">Mitigation Recommendations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../l1tf.html#mitigation-status">Mitigation Status</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../VBSK-analysis.html">VBS-K Framework Virtualization Overhead Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../VBSK-analysis.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../VBSK-analysis.html#architecture-of-virtio-echo">Architecture of VIRTIO-ECHO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../VBSK-analysis.html#virtualization-overhead-analysis">Virtualization Overhead Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../VBSK-analysis.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modularity.html">ACRN Hypervisor: Modular Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modularity.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modularity.html#principles">Principles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../modularity.html#minimizing-cyclic-dependencies">Minimizing Cyclic Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../modularity.html#measuring-complexity">Measuring Complexity</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modularity.html#architecture">Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modularity.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html">API Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/hypercall_api.html">Hypercall APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/devicemodel_api.html">Device Model APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/GVT-g_api.html">ACRN GVT-g APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/GVT-g_api.html#core-driver-infrastructure">Core Driver Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/GVT-g_api.html#vhm-apis-called-from-acrngt">VHM APIs called from AcrnGT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/GVT-g_api.html#acrngt-mediated-pass-through-mpt-interface">AcrnGT mediated pass-through (MPT) interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/GVT-g_api.html#gvt-g-intel-gvt-ops-interface">GVT-g intel_gvt_ops interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/GVT-g_api.html#acrngt-sysfs-interface">AcrnGT sysfs interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/kconfig/index.html">Configuration Symbol Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/kconfig/index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/kconfig/index.html#supported-options">Supported Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#contributing-to-the-project">Contributing to the project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../contribute_guidelines.html">Contribution Guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../contribute_guidelines.html#licensing">Licensing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contribute_guidelines.html#developer-certification-of-origin-dco">Developer Certification of Origin (DCO)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contribute_guidelines.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contribute_guidelines.html#repository-layout">Repository layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contribute_guidelines.html#submitting-issues">Submitting Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contribute_guidelines.html#contribution-tools-and-git-setup">Contribution Tools and Git Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contribute_guidelines.html#coding-style">Coding Style</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contribute_guidelines.html#contribution-workflow">Contribution Workflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../contribute_guidelines.html#commit-guidelines">Commit Guidelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../coding_guidelines.html">Coding Guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../coding_guidelines.html#preprocessor">Preprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../coding_guidelines.html#compilation-units">Compilation Units</a></li>
<li class="toctree-l4"><a class="reference internal" href="../coding_guidelines.html#declarations-and-initialization">Declarations and Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../coding_guidelines.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../coding_guidelines.html#statements">Statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../coding_guidelines.html#expressions">Expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../coding_guidelines.html#types">Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../coding_guidelines.html#identifiers">Identifiers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../coding_guidelines.html#coding-style">Coding Style</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../doc_guidelines.html">Documentation Guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#headings">Headings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#content-highlighting">Content Highlighting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#lists">Lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#multi-column-lists">Multi-column lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#file-names-and-commands">File names and Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#internal-cross-reference-linking">Internal Cross-Reference Linking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#non-ascii-characters">Non-ASCII Characters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#code-and-command-examples">Code and Command Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#tabs-spaces-and-indenting">Tabs, spaces, and indenting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../doc_guidelines.html#drawings">Drawings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../graphviz.html">Drawings using graphviz</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../graphviz.html#simple-directed-graph">Simple directed graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="../graphviz.html#adding-edge-labels">Adding edge labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../graphviz.html#tables">Tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../graphviz.html#finite-state-machine">Finite-State Machine</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../sw_design_guidelines.html">Software Design Guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../sw_design_guidelines.html#error-detection-and-error-handling">Error Detection and Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sw_design_guidelines.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/agl-vms.html">Running AGL as VMs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/agl-vms.html#hardware-setup">Hardware setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/agl-vms.html#connecting-hardware">Connecting hardware</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/agl-vms.html#software-setup">Software Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/agl-vms.html#service-os">Service OS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/agl-vms.html#building-acrn-kernel-for-agl-uos">Building ACRN kernel for AGL (UOS)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/agl-vms.html#setting-up-agls">Setting up AGLs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/building_uos_from_clearlinux.html">Building UOS from Clear Linux OS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/building_uos_from_clearlinux.html#build-uos-image-in-clear-linux-os">Build UOS image in Clear Linux OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/building_uos_from_clearlinux.html#start-the-user-os-uos">Start the User OS (UOS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/docbuild.html">ACRN documentation generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/docbuild.html#documentation-overview">Documentation overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/docbuild.html#set-up-the-documentation-working-folders">Set up the documentation working folders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/docbuild.html#installing-the-documentation-tools">Installing the documentation tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/docbuild.html#documentation-presentation-theme">Documentation presentation theme</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/docbuild.html#running-the-documentation-processors">Running the documentation processors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/docbuild.html#publishing-content">Publishing content</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/docbuild.html#document-versioning">Document Versioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/docbuild.html#filtering-expected-warnings">Filtering expected warnings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/rt_linux.html">Using PREEMPT_RT-Linux for real-time UOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/skl-nuc.html">GPU Passthrough on Skylake NUC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/skl-nuc.html#hardware-platform">Hardware platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/skl-nuc.html#software-configuration">Software Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/skl-nuc.html#software-setup">Software Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/static-ip.html">Using a static IP address</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/static-ip.html#acrn-network-setup">ACRN Network Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/static-ip.html#setting-up-the-static-ip-address">Setting up the static IP address</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/static-ip.html#activate-the-new-configuration">Activate the new configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/trustyACRN.html">Trusty and Security Services in ACRN</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/trustyACRN.html#trusty-architecture">Trusty Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/trustyACRN.html#trusty-services">Trusty Services</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/trustyACRN.html#keystore">Keystore</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/trustyACRN.html#secure-storage-ss">Secure Storage (SS)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/trustyACRN.html#trusty-in-acrn">Trusty in ACRN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/trustyACRN.html#one-vm-two-worlds">One-VM, Two-Worlds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/trustyACRN.html#secure-storage-virtualization">Secure Storage Virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tutorials/trustyACRN.html#references">References:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/using_agl_as_uos.html">Using AGL as the User OS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_agl_as_uos.html#introduction-to-agl">Introduction to AGL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_agl_as_uos.html#steps-for-using-agl-as-the-uos">Steps for using AGL as the UOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_agl_as_uos.html#enable-the-agl-display">Enable the AGL display</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_agl_as_uos.html#follow-up">Follow up</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/using_partition_mode_on_up2.html">Using partition mode on UP2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_partition_mode_on_up2.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_partition_mode_on_up2.html#build-kernel-and-modules-for-partition-mode-uos">Build kernel and modules for partition mode UOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_partition_mode_on_up2.html#enable-partition-mode-in-acrn-hypervisor">Enable partition mode in ACRN hypervisor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_partition_mode_on_up2.html#switch-between-privileged-vms">Switch between privileged VMs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/using_sbl_on_up2.html">Using SBL on UP2 Board</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_sbl_on_up2.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_sbl_on_up2.html#build-sbl">Build SBL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_sbl_on_up2.html#flash-sbl-on-the-up2">Flash SBL on the UP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_sbl_on_up2.html#build-acrn-for-up2">Build ACRN for UP2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_sbl_on_up2.html#download-and-install-flash-tool">Download and install flash tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_sbl_on_up2.html#sos-and-laag-installation">SOS and LaaG Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_sbl_on_up2.html#boot-to-sos">Boot to SOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_sbl_on_up2.html#launch-uos">Launch UOS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/using_ubuntu_as_sos.html">Using Ubuntu as the Service OS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_ubuntu_as_sos.html#install-ubuntu-natively">Install Ubuntu (natively)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_ubuntu_as_sos.html#install-acrn">Install ACRN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_ubuntu_as_sos.html#install-the-service-os-kernel">Install the Service OS kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_ubuntu_as_sos.html#prepare-the-user-os-uos">Prepare the User OS (UOS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_ubuntu_as_sos.html#start-the-user-os-uos">Start the User OS (UOS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_ubuntu_as_sos.html#enabling-network-sharing">Enabling network sharing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/using_ubuntu_as_sos.html#enabling-usb-keyboard-and-mouse">Enabling USB keyboard and mouse</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes_0.6.html">ACRN v0.6 (Feb 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.6.html#version-0-6-new-features">Version 0.6 new features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.6.html#fixed-issues">Fixed Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.6.html#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.6.html#change-log">Change Log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes_0.5.html">ACRN v0.5 (Jan 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.5.html#version-0-5-new-features">Version 0.5 new features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.5.html#fixed-issues">Fixed Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.5.html#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.5.html#change-log">Change Log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes_0.4.html">ACRN v0.4 (Dec 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.4.html#version-0-4-new-features">Version 0.4 new features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.4.html#fixed-issues">Fixed Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.4.html#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.4.html#change-log">Change Log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes_0.3.html">ACRN v0.3 (Nov 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.3.html#version-0-3-new-features">Version 0.3 new features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.3.html#fixed-issues">Fixed Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.3.html#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.3.html#change-log">Change Log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes_0.2.html">ACRN v0.2 (Sep 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.2.html#version-0-2-new-features">Version 0.2 new features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#vt-x-vt-d">VT-x, VT-d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#pic-ioapic-msi-msi-x-pci-lapic">PIC/IOAPIC/MSI/MSI-X/PCI/LAPIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#ethernet">Ethernet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#storage-emmc">Storage (eMMC)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#usb-xdci">USB (xDCI)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#usb-mediator-xhci-and-drd">USB Mediator (xHCI and DRD)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#csme">CSME</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#wifi">WiFi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#ipu-mipi-cs2-hdmi-in">IPU (MIPI-CS2, HDMI-in)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#bluetooth">Bluetooth</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#gpu-preemption">GPU  – Preemption</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#gpu-display-surface-sharing-via-hyper-dma">GPU – display surface sharing via Hyper DMA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.2.html#s3">S3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.2.html#fixed-issues">Fixed Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.2.html#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.2.html#change-log">Change Log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes_0.1.html">ACRN v0.1 (July 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.1.html#version-0-1-new-features">Version 0.1 new features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.1.html#hardware-support">Hardware Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.1.html#gvt-g-for-acrn">GVT-g for ACRN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.1.html#virtio-standard-is-supported">Virtio standard is supported</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.1.html#device-pass-through-support">Device pass-through support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.1.html#hypervisor-configuration">Hypervisor configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes_0.1.html#new-acrn-tools">New ACRN tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.1.html#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes_0.1.html#change-log">Change Log</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq.html#what-hardware-does-acrn-support">What hardware does ACRN support?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq.html#clear-linux-os-fails-to-boot-on-my-nuc">Clear Linux* OS fails to boot on my NUC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq.html#how-do-i-configure-acrn-s-memory-use">How do I configure ACRN’s memory use?</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Project ACRN™</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer Guides</a> &raquo;</li>
        
          <li><a href="index.html">High-Level Design Guides</a> &raquo;</li>
        
          <li><a href="hld-hypervisor.html">Hypervisor high-level design</a> &raquo;</li>
        
      <li>Virtual Interrupt</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="virtual-interrupt">
<span id="virtual-interrupt-hld"></span><h1>Virtual Interrupt<a class="headerlink" href="#virtual-interrupt" title="Permalink to this headline">¶</a></h1>
<p>This section introduces ACRN guest virtual interrupt
management, which includes:</p>
<ul class="simple">
<li>VCPU request for virtual interrupt kick off,</li>
<li>vPIC/vIOAPIC/vLAPIC for virtual interrupt injection interfaces,</li>
<li>physical-to-virtual interrupt mapping for a pass-thru device, and</li>
<li>the process of VMX interrupt/exception injection.</li>
</ul>
<p>A guest VM never owns any physical interrupts. All interrupts received by
Guest OS come from a virtual interrupt injected by vLAPIC, vIOAPIC or
vPIC. Such virtual interrupts are triggered either from a pass-through
device or from I/O mediators in SOS via hypercalls. Section 3.8.6
introduces how the hypervisor manages the mapping between physical and
virtual interrupts for pass-through devices.</p>
<p>Emulation for devices is inside SOS user space device model, i.e.,
acrn-dm. However for performance consideration: vLAPIC, vIOAPIC, and vPIC
are emulated inside HV directly.</p>
<p>From guest OS point of view, vPIC is Virtual Wire Mode via vIOAPIC. The
symmetric I/O Mode is shown in <a class="reference internal" href="#pending-virt-interrupt"><span class="std std-numref">Figure 76</span></a> later in
this section.</p>
<p>The following command line
options to guest Linux affects whether it uses PIC or IOAPIC:</p>
<ul class="simple">
<li><strong>Kernel boot param with vPIC</strong>: add “maxcpu=0” Guest OS will use PIC</li>
<li><strong>Kernel boot param with vIOAPIC</strong>: add “maxcpu=1” (as long as not “0”)
Guest OS will use IOAPIC. And Keep IOAPIC pin2 as source of PIC.</li>
</ul>
<div class="section" id="vcpu-request-for-interrupt-injection">
<h2>vCPU Request for Interrupt Injection<a class="headerlink" href="#vcpu-request-for-interrupt-injection" title="Permalink to this headline">¶</a></h2>
<p>The vCPU request mechanism (described in <a class="reference internal" href="hv-cpu-virt.html#pending-request-handlers"><span class="std std-ref">Pending Request Handlers</span></a>) is leveraged
to inject interrupts to a certain vCPU. As mentioned in
<a class="reference internal" href="hv-interrupt.html#ipi-management"><span class="std std-ref">IPI Management</span></a>,
physical vector 0xF0 is used to kick VCPU out of its VMX non-root mode,
used to make a request for virtual interrupt injection or other
requests such as flush EPT.</p>
<p>The eventid supported for virtual interrupt injection includes:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define ACRN_REQUEST_EXCP   0  </span><span class="cm">/* request for exception injection */</span><span class="cp"></span>
<span class="cp">#define ACRN_REQUEST_EVENT  1  </span><span class="cm">/* vLAPIC event */</span><span class="cp"></span>
<span class="cp">#define ACRN_REQUEST_EXTINT 2  </span><span class="cm">/* external interrupt from vPIC */</span><span class="cp"></span>
<span class="cp">#define ACRN_REQUEST_NMI    3  </span><span class="cm">/* non-maskable interrupt */</span><span class="cp"></span>
</pre></div>
</div>
<p>The <em>vcpu_make_request</em> is necessary for a virtual interrupt
injection. If the target vCPU is running under VMX non-root mode, it
will send an IPI to kick it out, which leads to an external-interrupt
VM-Exit. For some cases there is no need to send IPI when making a request,
because the CPU making the request itself is the target VCPU. For
example, the #GP exception request always happens on the current CPU when it
finds an invalid emulation has happened. An external interrupt for a pass-thru
device always happens on the VCPUs this device belonging to, so after it
triggers an external-interrupt VM-Exit, the current CPU is also the
target VCPU.</p>
</div>
<div class="section" id="virtual-lapic">
<h2>Virtual LAPIC<a class="headerlink" href="#virtual-lapic" title="Permalink to this headline">¶</a></h2>
<p>LAPIC is virtualized for all Guest types: SOS and UOS. Given support by
the
physical processor, APICv Virtual Interrupt Delivery (VID) is enabled
and will support Posted-Interrupt feature. Otherwise, it will fall back to legacy
virtual interrupt injection mode.</p>
<p>vLAPIC provides the same features as the native LAPIC:</p>
<ul class="simple">
<li>Vector mask/unmask</li>
<li>Virtual vector injections (Level or Edge trigger mode) to vCPU</li>
<li>vIOAPIC notification of EOI processing</li>
<li>TSC Timer service</li>
<li>vLAPIC support CR8 to update TPR</li>
<li>INIT/STARTUP handling</li>
</ul>
<div class="section" id="vlapic-apis">
<h3>vLAPIC APIs<a class="headerlink" href="#vlapic-apis" title="Permalink to this headline">¶</a></h3>
<p>APIs are provided when an interrupt source from vLAPIC needs to inject
an interrupt, for example:</p>
<ul class="simple">
<li>from LVT like LAPIC timer</li>
<li>from vIOAPIC for a pass-thru device interrupt</li>
<li>from an emulated device for a MSI</li>
</ul>
<p>These APIs will finish by making a request for <em>ACRN_REQUEST_EVENT.</em></p>
<dl class="function">
<dt id="_CPPv327vlapic_get_deliverable_intrP11acrn_vlapic8uint32_t">
<span id="_CPPv227vlapic_get_deliverable_intrP11acrn_vlapic8uint32_t"></span><span id="vlapic_get_deliverable_intr__acrn_vlapicP.uint32_t"></span><span class="target" id="group__acrn__vlapic_gaef12e2faaf8518513b30c261018e2f19_1gaef12e2faaf8518513b30c261018e2f19"></span>void <code class="descname">vlapic_get_deliverable_intr</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vlapic *<em>vlapic</em>, uint32_t <em>vector</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv327vlapic_get_deliverable_intrP11acrn_vlapic8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get a deliverable virtual interrupt from irr to isr. </p>
<p>Transition ‘vector’ from IRR to ISR. This function is called with the vector returned by ‘<a class="reference internal" href="#group__acrn__vlapic_gaae01573a942eee45278bac965a6ca2f2_1gaae01573a942eee45278bac965a6ca2f2"><span class="std std-ref">vlapic_find_deliverable_intr()</span></a>’ when the guest is able to accept this interrupt (i.e. RFLAGS.IF = 1 and no conditions exist that block interrupt delivery).</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None</dd>
<dt><strong>Pre</strong></dt>
<dd>vlapic != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vlapic</span></code>: Pointer to target vLAPIC data structure </li>
<li><code class="docutils literal notranslate"><span class="pre">vector</span></code>: Target virtual interrupt vector</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv328vlapic_find_deliverable_intrPK11acrn_vlapicP8uint32_t">
<span id="_CPPv228vlapic_find_deliverable_intrPK11acrn_vlapicP8uint32_t"></span><span id="vlapic_find_deliverable_intr__acrn_vlapicCP.uint32_tP"></span><span class="target" id="group__acrn__vlapic_gaae01573a942eee45278bac965a6ca2f2_1gaae01573a942eee45278bac965a6ca2f2"></span>bool <code class="descname">vlapic_find_deliverable_intr</code><span class="sig-paren">(</span><em class="property">const</em> <em class="property">struct</em> acrn_vlapic *<em>vlapic</em>, uint32_t *<em>vecptr</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv328vlapic_find_deliverable_intrPK11acrn_vlapicP8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Find a deliverable virtual interrupts for vLAPIC in irr. </p>
<p><dl class="docutils">
<dt><strong>Remark</strong></dt>
<dd>The vector does not automatically transition to the ISR as a result of calling this function. </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vlapic</span></code>: Pointer to target vLAPIC data structure </li>
<li><code class="docutils literal notranslate"><span class="pre">vecptr</span></code>: Pointer to vector buffer and will be filled with eligible vector if any.</li>
</ul>
</dd>
<dt><strong>Return Value</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">false</span></code>: There is no deliverable pending vector. </li>
<li><code class="docutils literal notranslate"><span class="pre">true</span></code>: There is deliverable vector.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv321vlapic_set_local_intrP7acrn_vm8uint16_t8uint32_t">
<span id="_CPPv221vlapic_set_local_intrP7acrn_vm8uint16_t8uint32_t"></span><span id="vlapic_set_local_intr__acrn_vmP.uint16_t.uint32_t"></span><span class="target" id="group__acrn__vlapic_ga54c370205764fcb27f220db3583684c5_1ga54c370205764fcb27f220db3583684c5"></span>int32_t <code class="descname">vlapic_set_local_intr</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vm *<em>vm</em>, uint16_t <em>vcpu_id_arg</em>, uint32_t <em>lvt_index</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv321vlapic_set_local_intrP7acrn_vm8uint16_t8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Triggers LAPIC local interrupt(LVT). </p>
<p><dl class="docutils">
<dt><strong>Pre</strong></dt>
<dd>vm != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vm</span></code>: Pointer to VM data structure </li>
<li><code class="docutils literal notranslate"><span class="pre">vcpu_id_arg</span></code>: ID of vCPU, BROADCAST_CPU_ID means triggering interrupt to all vCPUs. </li>
<li><code class="docutils literal notranslate"><span class="pre">lvt_index</span></code>: The index which LVT would to be fired.</li>
</ul>
</dd>
<dt><strong>Return Value</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">0</span></code>: on success. </li>
<li><code class="docutils literal notranslate"><span class="pre">-EINVAL</span></code>: on error that vcpu_id_arg or vector of the LVT is invalid.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv315vlapic_intr_msiP7acrn_vm8uint64_t8uint64_t">
<span id="_CPPv215vlapic_intr_msiP7acrn_vm8uint64_t8uint64_t"></span><span id="vlapic_intr_msi__acrn_vmP.uint64_t.uint64_t"></span><span class="target" id="group__acrn__vlapic_gaa6c0a8e47721be0b1416c90436088d79_1gaa6c0a8e47721be0b1416c90436088d79"></span>int32_t <code class="descname">vlapic_intr_msi</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vm *<em>vm</em>, uint64_t <em>addr</em>, uint64_t <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv315vlapic_intr_msiP7acrn_vm8uint64_t8uint64_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Inject MSI to target VM. </p>
<p><dl class="docutils">
<dt><strong>Pre</strong></dt>
<dd>vm != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vm</span></code>: Pointer to VM data structure </li>
<li><code class="docutils literal notranslate"><span class="pre">addr</span></code>: MSI address. </li>
<li><code class="docutils literal notranslate"><span class="pre">msg</span></code>: MSI data.</li>
</ul>
</dd>
<dt><strong>Return Value</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">0</span></code>: on success. </li>
<li><code class="docutils literal notranslate"><span class="pre">-1</span></code>: on error that addr is invalid.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv324apicv_get_pir_desc_paddrP9acrn_vcpu">
<span id="_CPPv224apicv_get_pir_desc_paddrP9acrn_vcpu"></span><span id="apicv_get_pir_desc_paddr__acrn_vcpuP"></span><span class="target" id="group__acrn__vlapic_gaecfa8d00ca0b1479093db4325060f15d_1gaecfa8d00ca0b1479093db4325060f15d"></span>uint64_t <code class="descname">apicv_get_pir_desc_paddr</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vcpu *<em>vcpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv324apicv_get_pir_desc_paddrP9acrn_vcpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get physical address to PIR description. </p>
<p>If APICv Posted-interrupt is supported, this address will be configured to VMCS “Posted-interrupt descriptor address” field.</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>physicall address to PIR</dd>
<dt><strong>Pre</strong></dt>
<dd>vcpu != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vcpu</span></code>: Target vCPU</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
<div class="section" id="eoi-processing">
<h3>EOI processing<a class="headerlink" href="#eoi-processing" title="Permalink to this headline">¶</a></h3>
<p>EOI virtualization is enabled if APICv virtual interrupt delivery is
supported. Except for level triggered interrupts, VM will not exit in
case of EOI.</p>
<p>In case of no APICv virtual interrupt delivery support, vLAPIC requires
EOI from Guest OS whenever a vector was acknowledged and processed by
guest. vLAPIC behavior is the same as HW LAPIC. Once an EOI is received,
it clears the highest priority vector in ISR and TMR, and updates PPR
status. vLAPIC will then notify vIOAPIC if the corresponding vector
comes from vIOAPIC. This only occurs for the level triggered interrupts.</p>
</div>
<div class="section" id="lapic-passthrough-based-on-vlapic">
<h3>LAPIC passthrough based on vLAPIC<a class="headerlink" href="#lapic-passthrough-based-on-vlapic" title="Permalink to this headline">¶</a></h3>
<p>LAPIC passthrough is supported based on vLAPIC, after switch to x2APIC
mode. In case of LAPIC passthrough based on vLAPIC, the system will have the
following characteristics.</p>
<ul class="simple">
<li>IRQs received by the LAPIC can be handled by the Guest VM without <code class="docutils literal notranslate"><span class="pre">vmexit</span></code></li>
<li>Guest VM always see virtual LAPIC IDs for security reasons</li>
<li>most MSRs are directly accessible from Guest VM except for <code class="docutils literal notranslate"><span class="pre">XAPICID</span></code>,
<code class="docutils literal notranslate"><span class="pre">LDR</span></code> and <code class="docutils literal notranslate"><span class="pre">ICR</span></code>. Write operations to <code class="docutils literal notranslate"><span class="pre">ICR</span></code> will be trapped to avoid
malicious IPI. Read operations to <code class="docutils literal notranslate"><span class="pre">XAPIC</span></code> and <code class="docutils literal notranslate"><span class="pre">LDR</span></code> will be trapped in
order to make the Guest VM always see the virtual LAPIC IDs instead of the
physical ones.</li>
</ul>
</div>
</div>
<div class="section" id="virtual-ioapic">
<h2>Virtual IOAPIC<a class="headerlink" href="#virtual-ioapic" title="Permalink to this headline">¶</a></h2>
<p>vIOAPIC is emulated by HV when Guest accesses MMIO GPA range:
0xFEC00000-0xFEC01000. vIOAPIC for SOS should match to the native HW
IOAPIC Pin numbers. vIOAPIC for UOS provides 48 Pins. As the vIOAPIC is
always associated with vLAPIC, the virtual interrupt injection from
vIOAPIC will finally trigger a request for vLAPIC event by calling
vLAPIC APIs.</p>
<p><strong>Supported APIs:</strong></p>
<dl class="function">
<dt id="_CPPv324vioapic_set_irqline_lockPK7acrn_vm8uint32_t8uint32_t">
<span id="_CPPv224vioapic_set_irqline_lockPK7acrn_vm8uint32_t8uint32_t"></span><span id="vioapic_set_irqline_lock__acrn_vmCP.uint32_t.uint32_t"></span><span class="target" id="group__acrn__vioapic_ga0dd4327deab2333653bf902516604867_1ga0dd4327deab2333653bf902516604867"></span>void <code class="descname">vioapic_set_irqline_lock</code><span class="sig-paren">(</span><em class="property">const</em> <em class="property">struct</em> acrn_vm *<em>vm</em>, uint32_t <em>irqline</em>, uint32_t <em>operation</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv324vioapic_set_irqline_lockPK7acrn_vm8uint32_t8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set vIOAPIC IRQ line status. </p>
<p><dl class="docutils">
<dt><strong>Pre</strong></dt>
<dd>irqline &lt; vioapic_pincount(vm)</dd>
<dt><strong>Return</strong></dt>
<dd>None </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vm</span></code>: Pointer to target VM </li>
<li><code class="docutils literal notranslate"><span class="pre">irqline</span></code>: Target IRQ number </li>
<li><code class="docutils literal notranslate"><span class="pre">operation</span></code>: Action options: GSI_SET_HIGH/GSI_SET_LOW/ GSI_RAISING_PULSE/GSI_FALLING_PULSE</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv326vioapic_set_irqline_nolockPK7acrn_vm8uint32_t8uint32_t">
<span id="_CPPv226vioapic_set_irqline_nolockPK7acrn_vm8uint32_t8uint32_t"></span><span id="vioapic_set_irqline_nolock__acrn_vmCP.uint32_t.uint32_t"></span><span class="target" id="group__acrn__vioapic_gaf441dacd60cc8f0f70f6990ff2faa4a8_1gaf441dacd60cc8f0f70f6990ff2faa4a8"></span>void <code class="descname">vioapic_set_irqline_nolock</code><span class="sig-paren">(</span><em class="property">const</em> <em class="property">struct</em> acrn_vm *<em>vm</em>, uint32_t <em>irqline</em>, uint32_t <em>operation</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv326vioapic_set_irqline_nolockPK7acrn_vm8uint32_t8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set vIOAPIC IRQ line status. </p>
<p>Similar with <a class="reference internal" href="#group__acrn__vioapic_ga0dd4327deab2333653bf902516604867_1ga0dd4327deab2333653bf902516604867"><span class="std std-ref">vioapic_set_irqline_lock()</span></a>,but would not make sure operation be done with ioapic lock.</p>
<p><dl class="docutils">
<dt><strong>Pre</strong></dt>
<dd>irqline &lt; vioapic_pincount(vm) </dd>
<dt><strong>Return</strong></dt>
<dd>None </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vm</span></code>: Pointer to target VM </li>
<li><code class="docutils literal notranslate"><span class="pre">irqline</span></code>: Target IRQ number </li>
<li><code class="docutils literal notranslate"><span class="pre">operation</span></code>: Action options: GSI_SET_HIGH/GSI_SET_LOW/ GSI_RAISING_PULSE/GSI_FALLING_PULSE</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
<div class="section" id="virtual-pic">
<h2>Virtual PIC<a class="headerlink" href="#virtual-pic" title="Permalink to this headline">¶</a></h2>
<p>vPIC is required for TSC calculation. Normally UOS will boot with
vIOAPIC and vPIC as the source of external interrupts to Guest. On every
VM Exit, HV will check if there are any pending external PIC interrupts.
vPIC APIs usage are similar to vIOAPIC.</p>
<p>ACRN hypervisor emulates a vPIC for each VM based on IO range 0x20~0x21,
0xa0~0xa1 and 0x4d0~0x4d1.</p>
<p>If an interrupt source from vPIC need to inject an interrupt, the
following APIs need be called, which will finally make a request for
<em>ACRN_REQUEST_EXTINT or ACRN_REQUEST_EVENT</em>:</p>
<dl class="function">
<dt id="_CPPv316vpic_set_irqlinePK7acrn_vm8uint32_t8uint32_t">
<span id="_CPPv216vpic_set_irqlinePK7acrn_vm8uint32_t8uint32_t"></span><span id="vpic_set_irqline__acrn_vmCP.uint32_t.uint32_t"></span><span class="target" id="group__acrn__vpic_ga02cde24b68a12f8892e7aaf8e02971f4_1ga02cde24b68a12f8892e7aaf8e02971f4"></span>void <code class="descname">vpic_set_irqline</code><span class="sig-paren">(</span><em class="property">const</em> <em class="property">struct</em> acrn_vm *<em>vm</em>, uint32_t <em>irqline</em>, uint32_t <em>operation</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv316vpic_set_irqlinePK7acrn_vm8uint32_t8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set vPIC IRQ line status. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vm</span></code>: Pointer to target VM </li>
<li><code class="docutils literal notranslate"><span class="pre">irqline</span></code>: Target IRQ number </li>
<li><code class="docutils literal notranslate"><span class="pre">operation</span></code>: action options:GSI_SET_HIGH/GSI_SET_LOW/ GSI_RAISING_PULSE/GSI_FALLING_PULSE</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<p>The following APIs are used to query the vector needed to be injected and ACK
the service (means move the interrupt from request service - IRR to in
service - ISR):</p>
<dl class="function">
<dt id="_CPPv317vpic_pending_intrP7acrn_vmP8uint32_t">
<span id="_CPPv217vpic_pending_intrP7acrn_vmP8uint32_t"></span><span id="vpic_pending_intr__acrn_vmP.uint32_tP"></span><span class="target" id="group__acrn__vpic_ga04faac8d82860826d1b2c090274d83d7_1ga04faac8d82860826d1b2c090274d83d7"></span>void <code class="descname">vpic_pending_intr</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vm *<em>vm</em>, uint32_t *<em>vecptr</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv317vpic_pending_intrP7acrn_vmP8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get pending virtual interrupts for vPIC. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vm</span></code>: Pointer to target VM </li>
<li><code class="docutils literal notranslate"><span class="pre">vecptr</span></code>: Pointer to vector buffer and will be filled with eligible vector if any.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv318vpic_intr_acceptedP7acrn_vm8uint32_t">
<span id="_CPPv218vpic_intr_acceptedP7acrn_vm8uint32_t"></span><span id="vpic_intr_accepted__acrn_vmP.uint32_t"></span><span class="target" id="group__acrn__vpic_ga14e814e9d8679097cc04dd60faedd115_1ga14e814e9d8679097cc04dd60faedd115"></span>void <code class="descname">vpic_intr_accepted</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vm *<em>vm</em>, uint32_t <em>vector</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv318vpic_intr_acceptedP7acrn_vm8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Accept virtual interrupt for vPIC. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None</dd>
<dt><strong>Pre</strong></dt>
<dd>vm != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vm</span></code>: Pointer to target VM </li>
<li><code class="docutils literal notranslate"><span class="pre">vector</span></code>: Target virtual interrupt vector</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
<div class="section" id="virtual-exception">
<h2>Virtual Exception<a class="headerlink" href="#virtual-exception" title="Permalink to this headline">¶</a></h2>
<p>When doing emulation, an exception may need to be triggered in
hypervisor, for example:</p>
<ul class="simple">
<li>if guest accesses an invalid vMSR register,</li>
<li>hypervisor needs to inject a #GP, or</li>
<li>during instruction emulation, an instruction fetch may access
a non-exist page from rip_gva, at that time a #PF need be injected.</li>
</ul>
<p>ACRN hypervisor implements virtual exception injection using these APIs:</p>
<dl class="function">
<dt id="_CPPv320vcpu_queue_exceptionP9acrn_vcpu8uint32_t8uint32_t">
<span id="_CPPv220vcpu_queue_exceptionP9acrn_vcpu8uint32_t8uint32_t"></span><span id="vcpu_queue_exception__acrn_vcpuP.uint32_t.uint32_t"></span><span class="target" id="group__acrn__virq_ga948fe1560690550cac86d7fac0644287_1ga948fe1560690550cac86d7fac0644287"></span>int32_t <code class="descname">vcpu_queue_exception</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vcpu *<em>vcpu</em>, uint32_t <em>vector_arg</em>, uint32_t <em>err_code_arg</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv320vcpu_queue_exceptionP9acrn_vcpu8uint32_t8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Queue exception to guest. </p>
<p>This exception may be injected immediately or later, depends on the exeception class.</p>
<p><dl class="docutils">
<dt><strong>Pre</strong></dt>
<dd>vcpu != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vcpu</span></code>: Pointer to vCPU. </li>
<li><code class="docutils literal notranslate"><span class="pre">vector_arg</span></code>: Vector of the exeception. </li>
<li><code class="docutils literal notranslate"><span class="pre">err_code_arg</span></code>: Error Code to be injected.</li>
</ul>
</dd>
<dt><strong>Return Value</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">0</span></code>: on success </li>
<li><code class="docutils literal notranslate"><span class="pre">-EINVAL</span></code>: on error that vector is invalid.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv318vcpu_inject_extintP9acrn_vcpu">
<span id="_CPPv218vcpu_inject_extintP9acrn_vcpu"></span><span id="vcpu_inject_extint__acrn_vcpuP"></span><span class="target" id="group__acrn__virq_ga673b97cbeb10edfe4cb86c56ca9f84ef_1ga673b97cbeb10edfe4cb86c56ca9f84ef"></span>void <code class="descname">vcpu_inject_extint</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vcpu *<em>vcpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv318vcpu_inject_extintP9acrn_vcpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Inject external interrupt to guest. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None</dd>
<dt><strong>Pre</strong></dt>
<dd>vcpu != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vcpu</span></code>: Pointer to vCPU.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv315vcpu_inject_nmiP9acrn_vcpu">
<span id="_CPPv215vcpu_inject_nmiP9acrn_vcpu"></span><span id="vcpu_inject_nmi__acrn_vcpuP"></span><span class="target" id="group__acrn__virq_gab2bf5d2e27986369bcd2bc7c318f586a_1gab2bf5d2e27986369bcd2bc7c318f586a"></span>void <code class="descname">vcpu_inject_nmi</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vcpu *<em>vcpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv315vcpu_inject_nmiP9acrn_vcpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Inject NMI to guest. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None</dd>
<dt><strong>Pre</strong></dt>
<dd>vcpu != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vcpu</span></code>: Pointer to vCPU.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv314vcpu_inject_gpP9acrn_vcpu8uint32_t">
<span id="_CPPv214vcpu_inject_gpP9acrn_vcpu8uint32_t"></span><span id="vcpu_inject_gp__acrn_vcpuP.uint32_t"></span><span class="target" id="group__acrn__virq_ga9b331cc3c9799e3d79056e2eb28de7ba_1ga9b331cc3c9799e3d79056e2eb28de7ba"></span>void <code class="descname">vcpu_inject_gp</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vcpu *<em>vcpu</em>, uint32_t <em>err_code</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv314vcpu_inject_gpP9acrn_vcpu8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Inject general protection exeception(GP) to guest. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None</dd>
<dt><strong>Pre</strong></dt>
<dd>vcpu != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vcpu</span></code>: Pointer to vCPU. </li>
<li><code class="docutils literal notranslate"><span class="pre">err_code</span></code>: Error Code to be injected.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv314vcpu_inject_pfP9acrn_vcpu8uint64_t8uint32_t">
<span id="_CPPv214vcpu_inject_pfP9acrn_vcpu8uint64_t8uint32_t"></span><span id="vcpu_inject_pf__acrn_vcpuP.uint64_t.uint32_t"></span><span class="target" id="group__acrn__virq_ga307769de85d083dcb2ae7be4b6981537_1ga307769de85d083dcb2ae7be4b6981537"></span>void <code class="descname">vcpu_inject_pf</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vcpu *<em>vcpu</em>, uint64_t <em>addr</em>, uint32_t <em>err_code</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv314vcpu_inject_pfP9acrn_vcpu8uint64_t8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Inject page fault exeception(PF) to guest. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None</dd>
<dt><strong>Pre</strong></dt>
<dd>vcpu != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vcpu</span></code>: Pointer to vCPU. </li>
<li><code class="docutils literal notranslate"><span class="pre">addr</span></code>: Address that result in PF. </li>
<li><code class="docutils literal notranslate"><span class="pre">err_code</span></code>: Error Code to be injected.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv314vcpu_inject_udP9acrn_vcpu">
<span id="_CPPv214vcpu_inject_udP9acrn_vcpu"></span><span id="vcpu_inject_ud__acrn_vcpuP"></span><span class="target" id="group__acrn__virq_ga10a95fb00a8169ddcbdaf22b86a7fe6c_1ga10a95fb00a8169ddcbdaf22b86a7fe6c"></span>void <code class="descname">vcpu_inject_ud</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vcpu *<em>vcpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv314vcpu_inject_udP9acrn_vcpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Inject invalid opcode exeception(UD) to guest. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None</dd>
<dt><strong>Pre</strong></dt>
<dd>vcpu != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vcpu</span></code>: Pointer to vCPU.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv314vcpu_inject_acP9acrn_vcpu">
<span id="_CPPv214vcpu_inject_acP9acrn_vcpu"></span><span id="vcpu_inject_ac__acrn_vcpuP"></span><span class="target" id="group__acrn__virq_ga74dfd2f4d868e1bed0c739c8625ef00c_1ga74dfd2f4d868e1bed0c739c8625ef00c"></span>void <code class="descname">vcpu_inject_ac</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vcpu *<em>vcpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv314vcpu_inject_acP9acrn_vcpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Inject alignment check exeception(AC) to guest. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None</dd>
<dt><strong>Pre</strong></dt>
<dd>vcpu != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vcpu</span></code>: Pointer to vCPU.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv314vcpu_inject_ssP9acrn_vcpu">
<span id="_CPPv214vcpu_inject_ssP9acrn_vcpu"></span><span id="vcpu_inject_ss__acrn_vcpuP"></span><span class="target" id="group__acrn__virq_ga1d208d3ecbd6b3fe62dbd9fdc335ad5e_1ga1d208d3ecbd6b3fe62dbd9fdc335ad5e"></span>void <code class="descname">vcpu_inject_ss</code><span class="sig-paren">(</span><em class="property">struct</em> acrn_vcpu *<em>vcpu</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv314vcpu_inject_ssP9acrn_vcpu" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Inject stack fault exeception(SS) to guest. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>None</dd>
<dt><strong>Pre</strong></dt>
<dd>vcpu != NULL </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal notranslate"><span class="pre">vcpu</span></code>: Pointer to vCPU.</li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<p>ACRN hypervisor uses the <em>vcpu_inject_gp/vcpu_inject_pf</em> functions
to queue exception request, and follows SDM vol3 - 6.15, Table 6-5 to
generate double fault if the condition is met.</p>
</div>
<div class="section" id="virtual-interrupt-injection">
<h2>Virtual Interrupt Injection<a class="headerlink" href="#virtual-interrupt-injection" title="Permalink to this headline">¶</a></h2>
<p>The source of virtual interrupts comes from either DM or assigned
devices.</p>
<ul class="simple">
<li><strong>For SOS assigned devices</strong>: as all devices are assigned to SOS
directly. Whenever there is a device’s physical interrupt, the
corresponding virtual interrupts are injected to SOS via
vLAPIC/vIOAPIC. SOS does not use vPIC and does not have emulated
devices. See section 3.8.5 Device assignment.</li>
<li><strong>For UOS assigned devices</strong>: only PCI devices could be assigned to
UOS. Virtual interrupt injection follows the same way as SOS. A
virtual interrupt injection operation is triggered when a
device’s physical interrupt occurs.</li>
<li><strong>For UOS emulated devices</strong>: DM (acrn-dm) is responsible for UOS
emulated devices’ interrupt lifecycle management. DM knows when
an emulated device needs to assert a virtual IOPAIC/PIC Pin or
needs to send a virtual MSI vector to Guest. These logic is
entirely handled by DM.</li>
</ul>
<div class="figure align-center" id="pending-virt-interrupt">
<img alt="../../_images/virtint-image64.png" src="../../_images/virtint-image64.png" />
<p class="caption"><span class="caption-number">Figure 76 </span><span class="caption-text">Handle pending virtual interrupt</span></p>
</div>
<p>Before APICv virtual interrupt delivery, a virtual interrupt can be
injected only if guest interrupt is allowed. There are many cases
that Guest <code class="docutils literal notranslate"><span class="pre">RFLAGS.IF</span></code> gets cleared and it would not accept any further
interrupts. HV will check for the available Guest IRQ windows before
injection.</p>
<p>NMI is unmasked interrupt and its injection is always allowed
regardless of the guest IRQ window status. If current IRQ
windows is not present, HV would enable
<code class="docutils literal notranslate"><span class="pre">MSR_IA32_VMX_PROCBASED_CTLS_IRQ_WIN</span> <span class="pre">(PROCBASED_CTRL.bit[2])</span></code> and
VM Enter directly. The injection will be done on next VM Exit once Guest
issues <code class="docutils literal notranslate"><span class="pre">STI</span> <span class="pre">(GuestRFLAG.IF=1)</span></code>.</p>
</div>
<div class="section" id="data-structures-and-interfaces">
<h2>Data structures and interfaces<a class="headerlink" href="#data-structures-and-interfaces" title="Permalink to this headline">¶</a></h2>
<p>There is no data structure exported to the other components in the
hypervisor for virtual interrupts. The APIs listed in the previous
sections are meant to be called whenever a virtual interrupt should be
injected or acknowledged.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Project ACRN.
      Last updated on Mar 08, 2019.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Project ACRN</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/latest/">latest</a></dd>
        
          <dd><a href="/0.6/">0.6</a></dd>
        
          <dd><a href="/0.5/">0.5</a></dd>
        
          <dd><a href="/0.4/">0.4</a></dd>
        
          <dd><a href="/0.3/">0.3</a></dd>
        
          <dd><a href="/0.2/">0.2</a></dd>
        
          <dd><a href="/0.1/">0.1</a></dd>
        
      </dl>
      <dl>
        <dt>On projectacrn.org</dt>
          <dd>
            <a href="https://www.projectacrn.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/projectacrn/acrn-hypervisor/wiki">Wiki</a>
          </dd>
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'v 0.7-unstable',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/acrn-custom.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>