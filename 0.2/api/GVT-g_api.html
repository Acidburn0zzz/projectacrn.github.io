

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ACRN GVT-g APIs &mdash; Project ACRN™ v 0.2-unstable documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/ACRN-favicon-32x32.png"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/acrn-custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuration Symbol Reference" href="../reference/kconfig/index.html" />
    <link rel="prev" title="Device Model APIs" href="devicemodel_api.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Project ACRN™
          

          
            
            <img src="../_static/ACRN_Logo_200w.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction to Project ACRN</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html#automotive-use-case-example">Automotive Use Case Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html#licensing">Licensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html#acrn-device-model-service-os-and-user-os">ACRN Device Model, Service OS, and User OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html#boot-sequence">Boot Sequence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html#acrn-hypervisor-architecture">ACRN Hypervisor Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html#acrn-device-model-architecture">ACRN Device Model Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html#device-pass-through">Device pass through</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../introduction/index.html#hardware-support-for-device-passthrough">Hardware support for device passthrough</a></li>
<li class="toctree-l3"><a class="reference internal" href="../introduction/index.html#hypervisor-support-for-device-passthrough">Hypervisor support for device passthrough</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html#acrn-i-o-mediator">ACRN I/O mediator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.html#virtio-framework-architecture">Virtio framework architecture</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/apl-nuc.html">Getting started guide for Intel NUC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/apl-nuc.html#hardware-setup">Hardware setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#firmware-update-on-the-nuc">Firmware update on the NUC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/apl-nuc.html#software-setup">Software setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#set-up-a-clear-linux-operating-system">Set up a Clear Linux Operating System</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#add-the-acrn-hypervisor-to-the-efi-partition">Add the ACRN hypervisor to the EFI Partition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#acrn-network-bridge">ACRN Network Bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#set-up-reference-uos">Set up Reference UOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#device-manager-memory-allocation-mechanism">Device Manager memory allocation mechanism</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/apl-nuc.html#build-acrn-from-source">Build ACRN from Source</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#install-build-tools-and-dependencies">Install build tools and dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#build-the-hypervisor-device-model-and-tools">Build the hypervisor, device model and tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#generate-the-hypervisor-configurations">Generate the hypervisor configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#modify-the-hypervisor-configurations">Modify the hypervisor configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/apl-nuc.html#create-a-new-default-configuration">Create a new default configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/up2.html">Getting started guide for UP2 board</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/up2.html#hardware-setup">Hardware setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/up2.html#connecting-to-the-serial-port">Connecting to the serial port</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/up2.html#software-setup">Software setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/up2.html#up2-serial-port-setting">UP2 serial port setting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/up2.html#up2-block-device">UP2 block device</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/up2.html#running-the-hypervisor">Running the hypervisor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../hardware.html">Supported Hardware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../hardware.html#intel-apollo-lake-nuc">Intel Apollo Lake NUC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware.html#up-squared-board">UP Squared board</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user-guides/index.html">User Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user-guides/acrn-shell.html">ACRN Shell Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guides/tools.html">Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tools/acrn-crashlog/README.html">ACRN-Crashlog</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/README.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/README.html#building">Building</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/README.html#installing">Installing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/README.html#source-code">Source Code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/README.html">acrnprobe</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/README.html#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/README.html#source-files">Source files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/README.html#configuration-files">Configuration files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/conf.html">acrnprobe Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/conf.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/conf.html#layout">Layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/conf.html#properties-of-group-members">Properties of group members</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/conf.html#crash-tree-in-acrnprobe">Crash tree in acrnprobe</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/acrnprobe/conf.html#sections">Sections</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tools/acrn-crashlog/usercrash/README.html">usercrash</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/usercrash/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/usercrash/README.html#design">Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/usercrash/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-crashlog/usercrash/README.html#souce-code">Souce Code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tools/acrn-manager/README.html">acrnctl and acrnd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-manager/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-manager/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-manager/README.html#acrnd">acrnd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrn-manager/README.html#build-and-install">Build and Install</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tools/acrnlog/README.html">acrnlog</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrnlog/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrnlog/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrnlog/README.html#build-and-install">Build and Install</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tools/acrntrace/README.html">acrntrace</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrntrace/README.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrntrace/README.html#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/acrntrace/README.html#build-and-install">Build and Install</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../developer-guides/index.html">Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../developer-guides/primer.html">Developer Primer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#source-tree-structure">Source Tree Structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#acrn-hypervisor-source-tree">ACRN hypervisor source tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#acrn-device-model-source-tree">ACRN Device Model source tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#acrn-tools-source-tree">ACRN Tools source tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#acrn-documentation-source-tree">ACRN documentation source tree</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#cpu-virtualization">CPU virtualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#host-gdt">Host GDT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#host-idt">Host IDT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#guest-smp-booting">Guest SMP Booting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#vmx-configuration">VMX configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#cpuid-and-guest-tsc-calibration">CPUID and Guest TSC calibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#rdtsc-rdtscp">RDTSC/RDTSCP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#cr-register-virtualization">CR Register virtualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#msr-bitmap">MSR BITMAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#i-o-bitmap">I/O BITMAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#exceptions">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#memory-virtualization">Memory virtualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#physical-memory-layout">Physical Memory Layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#pv-mmu-memory-mapping-in-the-hypervisor">PV (MMU) Memory Mapping in the Hypervisor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#pv-mmu-memory-mapping-in-vms">PV (MMU) Memory Mapping in VMs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#host-guest-ept-memory-mapping">Host-Guest (EPT) Memory Mapping</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#graphic-mediation">Graphic mediation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#i-o-emulation">I/O emulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#device-assignment-management">Device Assignment Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#pio-mmio-trap-flow">PIO/MMIO trap Flow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#virtual-interrupt">Virtual interrupt</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#virtual-lapic">Virtual LAPIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#virtual-ioapic">Virtual IOAPIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#virtual-pic">Virtual PIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#virtual-interrupt-injection">Virtual Interrupt Injection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#vt-x-and-vt-d">VT-x and VT-d</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#hypercall">Hypercall</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#device-emulation">Device emulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/primer.html#virtio-devices">Virtio Devices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#virtio-rnd">Virtio-rnd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#virtio-blk">Virtio-blk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#virtio-net">Virtio-net</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/primer.html#virtio-console">Virtio-console</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">API Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="hypercall_api.html">Hypercall APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="devicemodel_api.html">Device Model APIs</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ACRN GVT-g APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#core-driver-infrastructure">Core Driver Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vhm-apis-called-from-acrngt">VHM APIs called from AcrnGT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#acrngt-mediated-pass-through-mpt-interface">AcrnGT mediated pass-through (MPT) interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gvt-g-intel-gvt-ops-interface">GVT-g intel_gvt_ops interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#acrngt-sysfs-interface">AcrnGT sysfs interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/kconfig/index.html">Configuration Symbol Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/kconfig/index.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/kconfig/index.html#supported-options">Supported Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developer-guides/index.html#high-level-design-guides">High-Level Design Guides</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/ACPI-virt-hld.html">ACPI Virtualization high-level design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/ACPI-virt-hld.html#acpi-introduction">ACPI introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/ACPI-virt-hld.html#acpi-virtualization">ACPI virtualization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/APL_GVT-g-hld.html">GVT-g high-level design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/APL_GVT-g-hld.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/APL_GVT-g-hld.html#background">Background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/APL_GVT-g-hld.html#mediated-pass-through">Mediated Pass-Through</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/APL_GVT-g-hld.html#high-level-architecture">High Level Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/APL_GVT-g-hld.html#key-techniques">Key Techniques</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/APL_GVT-g-hld.html#acrngt">AcrnGT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/GVT-g-porting.html">GVT-g Enabling and Porting Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/GVT-g-porting.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/GVT-g-porting.html#purpose-of-this-document">Purpose of this document</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/GVT-g-porting.html#overall-components">Overall Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/GVT-g-porting.html#core-scenario-interaction-sequences">Core scenario interaction sequences</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/GVT-g-porting.html#api-details">API details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/interrupt-hld.html">Interrupt Management high-level design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/interrupt-hld.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/interrupt-hld.html#hypervisor-physical-interrupt-management">Hypervisor Physical Interrupt Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/interrupt-hld.html#guest-virtual-interrupt-management">Guest Virtual Interrupt Management</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/memmgt-hld.html">Memory Management high-level design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/memmgt-hld.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/memmgt-hld.html#hypervisor-memory-management">Hypervisor Memory Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/memmgt-hld.html#service-os-memory-management">Service OS Memory Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/memmgt-hld.html#user-os-memory-management">User OS Memory Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/memmgt-hld.html#memory-interaction">Memory Interaction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/network-virt-hld.html">Network Virtualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/network-virt-hld.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/network-virt-hld.html#supported-features-notes">Supported Features Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/network-virt-hld.html#acrn-virtio-network-calling-stack">ACRN Virtio-Network Calling Stack</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/security-hld.html">Security high-level design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/security-hld.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/security-hld.html#background">Background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/security-hld.html#acrn-high-level-security-architecture">ACRN High-Level Security Architecture</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/uart-virtualization.html">UART Virtualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/uart-virtualization.html#architecture">Architecture</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/virtio-hld.html">Virtio high-level design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/virtio-hld.html#virtio-device">Virtio Device</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/virtio-console.html">Virtio-Console High-Level design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/virtio-console.html#console-backend-use-cases">Console Backend Use Cases</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/watchdog-hld.html">Watchdog Virtualization in Device Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/watchdog-hld.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/watchdog-hld.html#uos-watchdog-work-flow">UOS watchdog work flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/watchdog-hld.html#implementation-in-acrn-and-how-to-use-it">Implementation in ACRN and how to use it</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developer-guides/index.html#contributing-to-the-project">Contributing to the project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/contribute_guidelines.html">Contribution Guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/contribute_guidelines.html#licensing">Licensing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/contribute_guidelines.html#developer-certification-of-origin-dco">Developer Certification of Origin (DCO)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/contribute_guidelines.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/contribute_guidelines.html#repository-layout">Repository layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/contribute_guidelines.html#submitting-issues">Submitting Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/contribute_guidelines.html#contribution-tools-and-git-setup">Contribution Tools and Git Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/contribute_guidelines.html#coding-style">Coding Style</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/contribute_guidelines.html#contribution-workflow">Contribution Workflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/contribute_guidelines.html#commit-guidelines">Commit Guidelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/doc_guidelines.html">Documentation Guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#headings">Headings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#content-highlighting">Content Highlighting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#lists">Lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#multi-column-lists">Multi-column lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#file-names-and-commands">File names and Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#internal-cross-reference-linking">Internal Cross-Reference Linking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#non-ascii-characters">Non-ASCII Characters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#code-and-command-examples">Code and Command Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#tabs-spaces-and-indenting">Tabs, spaces, and indenting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/doc_guidelines.html#drawings">Drawings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developer-guides/graphviz.html">Drawings using graphviz</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/graphviz.html#simple-directed-graph">Simple directed graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/graphviz.html#adding-edge-labels">Adding edge labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/graphviz.html#tables">Tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developer-guides/graphviz.html#finite-state-machine">Finite-State Machine</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/docbuild.html">ACRN documentation generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docbuild.html#documentation-overview">Documentation overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docbuild.html#set-up-the-documentation-working-folders">Set up the documentation working folders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docbuild.html#installing-the-documentation-tools">Installing the documentation tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docbuild.html#documentation-presentation-theme">Documentation presentation theme</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docbuild.html#running-the-documentation-processors">Running the documentation processors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docbuild.html#publishing-content">Publishing content</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docbuild.html#filtering-expected-warnings">Filtering expected warnings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/static-ip.html">Using a static IP address</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/static-ip.html#acrn-network-setup">ACRN Network Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/static-ip.html#setting-up-the-static-ip-address">Setting up the static IP address</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/static-ip.html#activate-the-new-configuration">Activate the new configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/using_ubuntu_as_sos.html">Using Ubuntu as the Service OS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/using_ubuntu_as_sos.html#install-ubuntu-natively">Install Ubuntu (natively)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/using_ubuntu_as_sos.html#install-acrn">Install ACRN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/using_ubuntu_as_sos.html#install-the-service-os-kernel">Install the Service OS kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/using_ubuntu_as_sos.html#prepare-the-user-os-uos">Prepare the User OS (UOS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/using_ubuntu_as_sos.html#start-the-user-os-uos">Start the User OS (UOS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/using_ubuntu_as_sos.html#enabling-network-sharing">Enabling network sharing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/using_ubuntu_as_sos.html#enabling-usb-keyboard-and-mouse">Enabling USB keyboard and mouse</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../release_notes_0.2.html">ACRN v0.2 (Sep 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../release_notes_0.2.html#version-0-2-new-features">Version 0.2 new features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#vt-x-vt-d">VT-x, VT-d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#pic-ioapic-msi-msi-x-pci-lapic">PIC/IOAPIC/MSI/MSI-X/PCI/LAPIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#ethernet">Ethernet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#storage-emmc">Storage (eMMC)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#usb-xdci">USB (xDCI)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#usb-mediator-xhci-and-drd">USB Mediator (xHCI and DRD)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#csme">CSME</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#wifi">WiFi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#ipu-mipi-cs2-hdmi-in">IPU (MIPI-CS2, HDMI-in)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#bluetooth">Bluetooth</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#gpu-preemption">GPU  – Preemption</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#gpu-display-surface-sharing-via-hyper-dma">GPU – display surface sharing via Hyper DMA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.2.html#s3">S3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../release_notes_0.2.html#fixed-issues">Fixed Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release_notes_0.2.html#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release_notes_0.2.html#change-log">Change Log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../release_notes_0.1.html">ACRN v0.1 (July 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../release_notes_0.1.html#version-0-1-new-features">Version 0.1 new features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.1.html#hardware-support">Hardware Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.1.html#gvt-g-for-acrn">GVT-g for ACRN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.1.html#virtio-standard-is-supported">Virtio standard is supported</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.1.html#device-pass-through-support">Device pass-through support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.1.html#hypervisor-configuration">Hypervisor configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../release_notes_0.1.html#new-acrn-tools">New ACRN tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../release_notes_0.1.html#known-issues">Known Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release_notes_0.1.html#change-log">Change Log</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Project ACRN™</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../developer-guides/index.html">Developer Guides</a> &raquo;</li>
        
          <li><a href="index.html">API Documentation</a> &raquo;</li>
        
      <li>ACRN GVT-g APIs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="acrn-gvt-g-apis">
<span id="gvt-g-api"></span><h1>ACRN GVT-g APIs<a class="headerlink" href="#acrn-gvt-g-apis" title="Permalink to this headline">¶</a></h1>
<p>GVT-g is Intel’s open source GPU virtualization solution and is up-streamed to
the Linux kernel. Its implementation over KVM is named KVMGT, over Xen it is
named XenGT, and over ACRN it is named AcrnGT. GVT-g can exports multiple
virtual GPU (vGPU) instances for virtual machine system (VM). A VM could be
assigned one vGPU instance. The guest OS graphic driver needs minor
modification to drive the vGPU adapter in a VM. Every vGPU instance will adopt
the full HW GPU’s accelerate capability for 3D render and display.</p>
<p>In the following document, AcrnGT refers to the glue layer between ACRN
hypervisor and GVT-g core device model. It works as the agent of
hypervisor-related services. It is the only layer that needs to get rewritten
when porting GVT-g to another hypervisor. For simplicity, in the rest of this
document, GVT is used to refer to the core device model component of GVT-g,
specifically corresponding to <code class="docutils literal notranslate"><span class="pre">gvt.ko</span></code> when built as a module.</p>
<div class="section" id="core-driver-infrastructure">
<h2>Core Driver Infrastructure<a class="headerlink" href="#core-driver-infrastructure" title="Permalink to this headline">¶</a></h2>
<p>This section covers core driver infrastructure API used by both the display
and the <a class="reference external" href="https://lwn.net/Articles/283798/">Graphics Execution Manager(GEM)</a> parts of <a class="reference external" href="https://01.org/linuxgraphics/gfx-docs/drm/gpu/i915.html">i915 driver</a>.</p>
<div class="section" id="intel-gvt-g-guest-support-vgpu">
<h3>Intel GVT-g Guest Support(vGPU)<a class="headerlink" href="#intel-gvt-g-guest-support-vgpu" title="Permalink to this headline">¶</a></h3>
<p>Intel GVT-g is a graphics virtualization technology which shares the
GPU among multiple virtual machines on a time-sharing basis. Each
virtual machine is presented a virtual GPU (vGPU), which has equivalent
features as the underlying physical GPU (pGPU), so i915 driver can run
seamlessly in a virtual machine. This file provides vGPU specific
optimizations when running in a virtual machine, to reduce the complexity
of vGPU emulation and to improve the overall performance.</p>
<p>A primary function introduced here is so-called “address space ballooning”
technique. Intel GVT-g partitions global graphics memory among multiple VMs,
so each VM can directly access a portion of the memory without hypervisor’s
intervention, e.g. filling textures or queuing commands. However with the
partitioning an unmodified i915 driver would assume a smaller graphics
memory starting from address ZERO, then requires vGPU emulation module to
translate the graphics address between ‘guest view’ and ‘host view’, for
all registers and command opcodes which contain a graphics memory address.
To reduce the complexity, Intel GVT-g introduces “address space ballooning”,
by telling the exact partitioning knowledge to each guest i915 driver, which
then reserves and prevents non-allocated portions from allocation. Thus vGPU
emulation module only needs to scan and validate graphics addresses without
complexity of address translation.</p>
<dl class="function">
<dt id="c.i915_check_vgpu">
void <code class="descname">i915_check_vgpu</code><span class="sig-paren">(</span>struct drm_i915_private *<em>&nbsp;dev_priv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.i915_check_vgpu" title="Permalink to this definition">¶</a></dt>
<dd><p>detect virtual GPU</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_i915_private</span> <span class="pre">*</span> <span class="pre">dev_priv</span></code></dt>
<dd>i915 device private</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called at the initialization stage, to detect whether
running on a vGPU.</p>
<dl class="function">
<dt id="c.intel_vgt_deballoon">
void <code class="descname">intel_vgt_deballoon</code><span class="sig-paren">(</span>struct drm_i915_private *<em>&nbsp;dev_priv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_vgt_deballoon" title="Permalink to this definition">¶</a></dt>
<dd><p>deballoon reserved graphics address trunks</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_i915_private</span> <span class="pre">*</span> <span class="pre">dev_priv</span></code></dt>
<dd>i915 device private data</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called to deallocate the ballooned-out graphic memory, when
driver is unloaded or when ballooning fails.</p>
<dl class="function">
<dt id="c.intel_vgt_balloon">
int <code class="descname">intel_vgt_balloon</code><span class="sig-paren">(</span>struct drm_i915_private *<em>&nbsp;dev_priv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_vgt_balloon" title="Permalink to this definition">¶</a></dt>
<dd><p>balloon out reserved graphics address trunks</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_i915_private</span> <span class="pre">*</span> <span class="pre">dev_priv</span></code></dt>
<dd>i915 device private data</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called at the initialization stage, to balloon out the
graphic address space allocated to other vGPUs, by marking these spaces as
reserved. The ballooning related knowledge(starting address and size of
the mappable/unmappable graphic memory) is described in the vgt_if structure
in a reserved mmio range.</p>
<p>To give an example, the drawing below depicts one typical scenario after
ballooning. Here the vGPU1 has 2 pieces of graphic address spaces ballooned
out each for the mappable and the non-mappable part. From the vGPU1 point of
view, the total size is the same as the physical one, with the start address
of its graphic space being zero. Yet there are some portions ballooned out(
the shadow part, which are marked as reserved by drm allocator). From the
host point of view, the graphic address space is partitioned by multiple
vGPUs in different VMs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                       <span class="n">vGPU1</span> <span class="n">view</span>         <span class="n">Host</span> <span class="n">view</span>
            <span class="mi">0</span> <span class="o">------&gt;</span> <span class="o">+-----------+</span>     <span class="o">+-----------+</span>
              <span class="o">^</span>       <span class="o">|</span><span class="c1">###########|     |   vGPU3   |</span>
              <span class="o">|</span>       <span class="o">|</span><span class="c1">###########|     +-----------+</span>
              <span class="o">|</span>       <span class="o">|</span><span class="c1">###########|     |   vGPU2   |</span>
              <span class="o">|</span>       <span class="o">+-----------+</span>     <span class="o">+-----------+</span>
       <span class="n">mappable</span> <span class="n">GM</span>    <span class="o">|</span> <span class="n">available</span> <span class="o">|</span> <span class="o">==&gt;</span> <span class="o">|</span>   <span class="n">vGPU1</span>   <span class="o">|</span>
              <span class="o">|</span>       <span class="o">+-----------+</span>     <span class="o">+-----------+</span>
              <span class="o">|</span>       <span class="o">|</span><span class="c1">###########|     |           |</span>
              <span class="n">v</span>       <span class="o">|</span><span class="c1">###########|     |   Host    |</span>
              <span class="o">+=======+===========+</span>     <span class="o">+===========+</span>
              <span class="o">^</span>       <span class="o">|</span><span class="c1">###########|     |   vGPU3   |</span>
              <span class="o">|</span>       <span class="o">|</span><span class="c1">###########|     +-----------+</span>
              <span class="o">|</span>       <span class="o">|</span><span class="c1">###########|     |   vGPU2   |</span>
              <span class="o">|</span>       <span class="o">+-----------+</span>     <span class="o">+-----------+</span>
     <span class="n">unmappable</span> <span class="n">GM</span>    <span class="o">|</span> <span class="n">available</span> <span class="o">|</span> <span class="o">==&gt;</span> <span class="o">|</span>   <span class="n">vGPU1</span>   <span class="o">|</span>
              <span class="o">|</span>       <span class="o">+-----------+</span>     <span class="o">+-----------+</span>
              <span class="o">|</span>       <span class="o">|</span><span class="c1">###########|     |           |</span>
              <span class="o">|</span>       <span class="o">|</span><span class="c1">###########|     |   Host    |</span>
              <span class="n">v</span>       <span class="o">|</span><span class="c1">###########|     |           |</span>
<span class="n">total</span> <span class="n">GM</span> <span class="n">size</span> <span class="o">------&gt;</span> <span class="o">+-----------+</span>     <span class="o">+-----------+</span>
</pre></div>
</div>
<p><strong>Return</strong></p>
<p>zero on success, non-zero if configuration invalid or ballooning failed</p>
</div>
<div class="section" id="intel-gvt-g-host-support-vgpu-device-model">
<h3>Intel GVT-g Host Support(vGPU device model)<a class="headerlink" href="#intel-gvt-g-host-support-vgpu-device-model" title="Permalink to this headline">¶</a></h3>
<p>Intel GVT-g is a graphics virtualization technology which shares the
GPU among multiple virtual machines on a time-sharing basis. Each
virtual machine is presented a virtual GPU (vGPU), which has equivalent
features as the underlying physical GPU (pGPU), so i915 driver can run
seamlessly in a virtual machine.</p>
<p>To virtualize GPU resources GVT-g driver depends on hypervisor technology
e.g KVM/VFIO/mdev, Xen, etc. to provide resource access trapping capability
and be virtualized within GVT-g device module. More architectural design
doc is available on <a class="reference external" href="https://01.org/group/2230/documentation-list">https://01.org/group/2230/documentation-list</a>.</p>
<dl class="function">
<dt id="c.intel_gvt_sanitize_options">
void <code class="descname">intel_gvt_sanitize_options</code><span class="sig-paren">(</span>struct drm_i915_private *<em>&nbsp;dev_priv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_sanitize_options" title="Permalink to this definition">¶</a></dt>
<dd><p>sanitize GVT related options</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_i915_private</span> <span class="pre">*</span> <span class="pre">dev_priv</span></code></dt>
<dd>drm i915 private data</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called at the i915 options sanitize stage.</p>
<dl class="function">
<dt id="c.intel_gvt_init">
int <code class="descname">intel_gvt_init</code><span class="sig-paren">(</span>struct drm_i915_private *<em>&nbsp;dev_priv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_init" title="Permalink to this definition">¶</a></dt>
<dd><p>initialize GVT components</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_i915_private</span> <span class="pre">*</span> <span class="pre">dev_priv</span></code></dt>
<dd>drm i915 private data</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called at the initialization stage to create a GVT device.</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_cleanup">
void <code class="descname">intel_gvt_cleanup</code><span class="sig-paren">(</span>struct drm_i915_private *<em>&nbsp;dev_priv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>cleanup GVT components when i915 driver is unloading</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_i915_private</span> <span class="pre">*</span> <span class="pre">dev_priv</span></code></dt>
<dd>drm i915 private *</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called at the i915 driver unloading stage, to shutdown
GVT components and release the related resources.</p>
</div>
</div>
<div class="section" id="vhm-apis-called-from-acrngt">
<h2>VHM APIs called from AcrnGT<a class="headerlink" href="#vhm-apis-called-from-acrngt" title="Permalink to this headline">¶</a></h2>
<p>The Virtio and Hypervisor Service Module (VHM) is a kernel module in the
Service OS acting as a middle layer to support the device model. (See the
<a class="reference internal" href="../introduction/index.html#acrn-io-mediator"><span class="std std-ref">ACRN I/O mediator</span></a> introduction for details.)</p>
<p>VHM requires an interrupt (vIRQ) number, and exposes some APIs to external
kernel modules such as GVT-g and the Virtio back-end (BE) service running in
kernel space.  VHM exposes a <code class="docutils literal notranslate"><span class="pre">char</span></code> device node in user space, and only
interacts with DM. The DM routes I/O request and response from and to other
modules via the <code class="docutils literal notranslate"><span class="pre">char</span></code> device to and from VHM. DM may use VHM for hypervisor
service (including remote memory map). VHM may directly service the request
such as for the remote memory map, or invoke hypercall. VHM also sends I/O
responses to user space modules, notified by vIRQ injections.</p>
<dl class="function">
<dt id="c.put_vm">
void <code class="descname">put_vm</code><span class="sig-paren">(</span>struct vhm_vm *<em>&nbsp;vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.put_vm" title="Permalink to this definition">¶</a></dt>
<dd><p>release vhm_vm of guest according to guest vmid If the latest reference count drops to zero, free vhm_vm as well</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vhm_vm</span> <span class="pre">*</span> <span class="pre">vm</span></code></dt>
<dd>pointer to vhm_vm which identify specific guest</dd>
</dl>
<dl class="function">
<dt id="c.vhm_get_vm_info">
int <code class="descname">vhm_get_vm_info</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;vmid</em>, struct vm_info *<em>&nbsp;info</em><span class="sig-paren">)</span><a class="headerlink" href="#c.vhm_get_vm_info" title="Permalink to this definition">¶</a></dt>
<dd><p>get vm_info of specific guest</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">vmid</span></code></dt>
<dd>guest vmid</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vm_info</span> <span class="pre">*</span> <span class="pre">info</span></code></dt>
<dd>pointer to vm_info for returned vm_info</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 on error</p>
<dl class="function">
<dt id="c.vhm_inject_msi">
int <code class="descname">vhm_inject_msi</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;vmid</em>, unsigned long<em>&nbsp;msi_addr</em>, unsigned long<em>&nbsp;msi_data</em><span class="sig-paren">)</span><a class="headerlink" href="#c.vhm_inject_msi" title="Permalink to this definition">¶</a></dt>
<dd><p>inject MSI interrupt to guest</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">vmid</span></code></dt>
<dd>guest vmid</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">msi_addr</span></code></dt>
<dd>MSI addr matches MSI spec</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">msi_data</span></code></dt>
<dd>MSI data matches MSI spec</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 on error</p>
<dl class="function">
<dt id="c.vhm_vm_gpa2hpa">
unsigned long <code class="descname">vhm_vm_gpa2hpa</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;vmid</em>, unsigned long<em>&nbsp;gpa</em><span class="sig-paren">)</span><a class="headerlink" href="#c.vhm_vm_gpa2hpa" title="Permalink to this definition">¶</a></dt>
<dd><p>convert guest physical address to host physical address</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">vmid</span></code></dt>
<dd>guest vmid</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">gpa</span></code></dt>
<dd>guest physical address</dd>
</dl>
<p><strong>Return</strong></p>
<p>host physical address, &lt;0 on error</p>
<dl class="function">
<dt id="c.acrn_ioreq_create_client">
int <code class="descname">acrn_ioreq_create_client</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;vmid</em>, ioreq_handler_t<em>&nbsp;handler</em>, char *<em>&nbsp;name</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_create_client" title="Permalink to this definition">¶</a></dt>
<dd><p>create ioreq client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">vmid</span></code></dt>
<dd>ID to identify guest</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ioreq_handler_t</span> <span class="pre">handler</span></code></dt>
<dd>ioreq_handler of ioreq client
If client want request handled in client thread context, set
this parameter to NULL. If client want request handled out of
client thread context, set handler function pointer of its own.
VHM will create kernel thread and call handler to handle request</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*</span> <span class="pre">name</span></code></dt>
<dd>the name of ioreq client</dd>
</dl>
<p><strong>Return</strong></p>
<p>client id on success, &lt;0 on error</p>
<dl class="function">
<dt id="c.acrn_ioreq_destroy_client">
void <code class="descname">acrn_ioreq_destroy_client</code><span class="sig-paren">(</span>int<em>&nbsp;client_id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_destroy_client" title="Permalink to this definition">¶</a></dt>
<dd><p>destroy ioreq client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">client_id</span></code></dt>
<dd>client id to identify ioreq client</dd>
</dl>
<dl class="function">
<dt id="c.acrn_ioreq_add_iorange">
int <code class="descname">acrn_ioreq_add_iorange</code><span class="sig-paren">(</span>int<em>&nbsp;client_id</em>, uint32_t<em>&nbsp;type</em>, long<em>&nbsp;start</em>, long<em>&nbsp;end</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_add_iorange" title="Permalink to this definition">¶</a></dt>
<dd><p>add iorange monitored by ioreq client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">client_id</span></code></dt>
<dd>client id to identify ioreq client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">type</span></code></dt>
<dd>iorange type</dd>
<dt><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">start</span></code></dt>
<dd>iorange start address</dd>
<dt><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">end</span></code></dt>
<dd>iorange end address</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 on error</p>
<dl class="function">
<dt id="c.acrn_ioreq_del_iorange">
int <code class="descname">acrn_ioreq_del_iorange</code><span class="sig-paren">(</span>int<em>&nbsp;client_id</em>, uint32_t<em>&nbsp;type</em>, long<em>&nbsp;start</em>, long<em>&nbsp;end</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_del_iorange" title="Permalink to this definition">¶</a></dt>
<dd><p>del iorange monitored by ioreq client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">client_id</span></code></dt>
<dd>client id to identify ioreq client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">type</span></code></dt>
<dd>iorange type</dd>
<dt><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">start</span></code></dt>
<dd>iorange start address</dd>
<dt><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">end</span></code></dt>
<dd>iorange end address</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 on error</p>
<dl class="function">
<dt id="c.acrn_ioreq_get_reqbuf">
struct vhm_request * <code class="descname">acrn_ioreq_get_reqbuf</code><span class="sig-paren">(</span>int<em>&nbsp;client_id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_get_reqbuf" title="Permalink to this definition">¶</a></dt>
<dd><p>get request buffer request buffer is shared by all clients in one guest</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">client_id</span></code></dt>
<dd>client id to identify ioreq client</dd>
</dl>
<p><strong>Return</strong></p>
<p>pointer to request buffer, NULL on error</p>
<dl class="function">
<dt id="c.acrn_ioreq_attach_client">
int <code class="descname">acrn_ioreq_attach_client</code><span class="sig-paren">(</span>int<em>&nbsp;client_id</em>, bool<em>&nbsp;check_kthread_stop</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_attach_client" title="Permalink to this definition">¶</a></dt>
<dd><p>start handle request for ioreq client If request is handled out of client thread context, this function is only called once to be ready to handle new request.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">client_id</span></code></dt>
<dd>client id to identify ioreq client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">check_kthread_stop</span></code></dt>
<dd>whether check current kthread should be stopped</dd>
</dl>
<p><strong>Description</strong></p>
<p>If request is handled in client thread context, this function must
be called every time after the previous request handling is completed
to be ready to handle new request.</p>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 on error, 1 if ioreq client is destroying</p>
<dl class="function">
<dt id="c.acrn_ioreq_distribute_request">
int <code class="descname">acrn_ioreq_distribute_request</code><span class="sig-paren">(</span>struct vhm_vm *<em>&nbsp;vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_distribute_request" title="Permalink to this definition">¶</a></dt>
<dd><p>deliver request to corresponding client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">vhm_vm</span> <span class="pre">*</span> <span class="pre">vm</span></code></dt>
<dd>pointer to guest</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 always</p>
<dl class="function">
<dt id="c.acrn_ioreq_complete_request">
int <code class="descname">acrn_ioreq_complete_request</code><span class="sig-paren">(</span>int<em>&nbsp;client_id</em>, uint64_t<em>&nbsp;vcpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_complete_request" title="Permalink to this definition">¶</a></dt>
<dd><p>notify guest request handling is completed</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">client_id</span></code></dt>
<dd>client id to identify ioreq client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">vcpu</span></code></dt>
<dd>identify request submitter</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 on error</p>
<dl class="function">
<dt id="c.acrn_ioreq_intercept_bdf">
void <code class="descname">acrn_ioreq_intercept_bdf</code><span class="sig-paren">(</span>int<em>&nbsp;client_id</em>, int<em>&nbsp;bus</em>, int<em>&nbsp;dev</em>, int<em>&nbsp;func</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_intercept_bdf" title="Permalink to this definition">¶</a></dt>
<dd><p>set intercept bdf info of ioreq client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">client_id</span></code></dt>
<dd>client id to identify ioreq client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">bus</span></code></dt>
<dd>bus number</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">dev</span></code></dt>
<dd>device number</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">func</span></code></dt>
<dd>function number</dd>
</dl>
<dl class="function">
<dt id="c.acrn_ioreq_unintercept_bdf">
void <code class="descname">acrn_ioreq_unintercept_bdf</code><span class="sig-paren">(</span>int<em>&nbsp;client_id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_ioreq_unintercept_bdf" title="Permalink to this definition">¶</a></dt>
<dd><p>clear intercept bdf info of ioreq client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">client_id</span></code></dt>
<dd>client id to identify ioreq client</dd>
</dl>
<dl class="function">
<dt id="c.acrn_hpa2gpa">
unsigned long <code class="descname">acrn_hpa2gpa</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;hpa</em><span class="sig-paren">)</span><a class="headerlink" href="#c.acrn_hpa2gpa" title="Permalink to this definition">¶</a></dt>
<dd><p>physical address conversion</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">hpa</span></code></dt>
<dd>host physical address</dd>
</dl>
<p><strong>Description</strong></p>
<p>convert host physical address (hpa) to guest physical address (gpa)
gpa and hpa is 1:1 mapping for service OS</p>
<p><strong>Return</strong></p>
<p>guest physical address</p>
<dl class="function">
<dt id="c.map_guest_phys">
void * <code class="descname">map_guest_phys</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;vmid</em>, u64<em>&nbsp;uos_phys</em>, size_t<em>&nbsp;size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.map_guest_phys" title="Permalink to this definition">¶</a></dt>
<dd><p>map guest physical address to SOS kernel virtual address</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">vmid</span></code></dt>
<dd>guest vmid</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">uos_phys</span></code></dt>
<dd>physical address in guest</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>the memory size mapped</dd>
</dl>
<p><strong>Return</strong></p>
<p>SOS kernel virtual address, NULL on error</p>
<dl class="function">
<dt id="c.unmap_guest_phys">
int <code class="descname">unmap_guest_phys</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;vmid</em>, u64<em>&nbsp;uos_phys</em><span class="sig-paren">)</span><a class="headerlink" href="#c.unmap_guest_phys" title="Permalink to this definition">¶</a></dt>
<dd><p>unmap guest physical address</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">vmid</span></code></dt>
<dd>guest vmid</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">uos_phys</span></code></dt>
<dd>physical address in guest</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 for error.</p>
<dl class="function">
<dt id="c.add_memory_region">
int <code class="descname">add_memory_region</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;vmid</em>, unsigned long<em>&nbsp;gpa</em>, unsigned long<em>&nbsp;host_gpa</em>, unsigned long<em>&nbsp;size</em>, unsigned int<em>&nbsp;mem_type</em>, unsigned int<em>&nbsp;mem_access_right</em><span class="sig-paren">)</span><a class="headerlink" href="#c.add_memory_region" title="Permalink to this definition">¶</a></dt>
<dd><p>add a guest memory region</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">vmid</span></code></dt>
<dd>guest vmid</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">gpa</span></code></dt>
<dd>gpa of UOS</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">host_gpa</span></code></dt>
<dd>gpa of SOS</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">size</span></code></dt>
<dd>memory region size</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">mem_type</span></code></dt>
<dd>memory mapping type. Possible value could be:
MEM_TYPE_WB
MEM_TYPE_WT
MEM_TYPE_UC
MEM_TYPE_WC
MEM_TYPE_WP</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">mem_access_right</span></code></dt>
<dd>memory mapping access. Possible value could be:
MEM_ACCESS_READ
MEM_ACCESS_WRITE
MEM_ACCESS_EXEC
MEM_ACCESS_RWX</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 for error.</p>
<dl class="function">
<dt id="c.del_memory_region">
int <code class="descname">del_memory_region</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;vmid</em>, unsigned long<em>&nbsp;gpa</em>, unsigned long<em>&nbsp;size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.del_memory_region" title="Permalink to this definition">¶</a></dt>
<dd><p>delete a guest memory region</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">vmid</span></code></dt>
<dd>guest vmid</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">gpa</span></code></dt>
<dd>gpa of UOS</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">size</span></code></dt>
<dd>memory region size</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 for error.</p>
<dl class="function">
<dt id="c.write_protect_page">
int <code class="descname">write_protect_page</code><span class="sig-paren">(</span>unsigned long<em>&nbsp;vmid</em>, unsigned long<em>&nbsp;gpa</em>, unsigned char<em>&nbsp;set</em><span class="sig-paren">)</span><a class="headerlink" href="#c.write_protect_page" title="Permalink to this definition">¶</a></dt>
<dd><p>change one page write protection</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">vmid</span></code></dt>
<dd>guest vmid</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">gpa</span></code></dt>
<dd>gpa in guest vmid</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">set</span></code></dt>
<dd>set or clear page write protection</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 on success, &lt;0 for error.</p>
</div>
<div class="section" id="acrngt-mediated-pass-through-mpt-interface">
<span id="mpt-interface"></span><h2>AcrnGT mediated pass-through (MPT) interface<a class="headerlink" href="#acrngt-mediated-pass-through-mpt-interface" title="Permalink to this headline">¶</a></h2>
<p>AcrnGT receives request from GVT module through MPT interface. Refer to the
<a class="reference internal" href="../developer-guides/primer.html#graphic-mediation"><span class="std std-ref">Graphic mediation</span></a> page.</p>
<p>A collection of function callbacks in the MPT module will be attached to GVT
host at the driver loading stage. AcrnGT MPT function callbacks are described
as below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">intel_gvt_mpt</span> <span class="n">acrn_gvt_mpt</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">host_init</span> <span class="o">=</span> <span class="n">acrngt_host_init</span><span class="p">,</span>
        <span class="p">.</span><span class="n">host_exit</span> <span class="o">=</span> <span class="n">acrngt_host_exit</span><span class="p">,</span>
        <span class="p">.</span><span class="n">attach_vgpu</span> <span class="o">=</span> <span class="n">acrngt_attach_vgpu</span><span class="p">,</span>
        <span class="p">.</span><span class="n">detach_vgpu</span> <span class="o">=</span> <span class="n">acrngt_detach_vgpu</span><span class="p">,</span>
        <span class="p">.</span><span class="n">inject_msi</span> <span class="o">=</span> <span class="n">acrngt_inject_msi</span><span class="p">,</span>
        <span class="p">.</span><span class="n">from_virt_to_mfn</span> <span class="o">=</span> <span class="n">acrngt_virt_to_mfn</span><span class="p">,</span>
        <span class="p">.</span><span class="n">set_wp_page</span> <span class="o">=</span> <span class="n">acrngt_set_wp_page</span><span class="p">,</span>
        <span class="p">.</span><span class="n">unset_wp_page</span> <span class="o">=</span> <span class="n">acrngt_unset_wp_page</span><span class="p">,</span>
        <span class="p">.</span><span class="n">read_gpa</span> <span class="o">=</span> <span class="n">acrngt_read_gpa</span><span class="p">,</span>
        <span class="p">.</span><span class="n">write_gpa</span> <span class="o">=</span> <span class="n">acrngt_write_gpa</span><span class="p">,</span>
        <span class="p">.</span><span class="n">gfn_to_mfn</span> <span class="o">=</span> <span class="n">acrngt_gfn_to_pfn</span><span class="p">,</span>
        <span class="p">.</span><span class="n">map_gfn_to_mfn</span> <span class="o">=</span> <span class="n">acrngt_map_gfn_to_mfn</span><span class="p">,</span>
        <span class="p">.</span><span class="n">set_trap_area</span> <span class="o">=</span> <span class="n">acrngt_set_trap_area</span><span class="p">,</span>
        <span class="p">.</span><span class="n">set_pvmmio</span> <span class="o">=</span> <span class="n">acrngt_set_pvmmio</span><span class="p">,</span>
        <span class="p">.</span><span class="n">pause_domain</span> <span class="o">=</span> <span class="n">acrn_pause_domain</span><span class="p">,</span>
        <span class="p">.</span><span class="n">unpause_domain</span><span class="o">=</span> <span class="n">acrn_unpause_domain</span><span class="p">,</span>
        <span class="p">.</span><span class="n">dom0_ready</span> <span class="o">=</span> <span class="n">acrngt_dom0_ready</span><span class="p">,</span>
<span class="p">};</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">acrn_gvt_mpt</span><span class="p">);</span>
</pre></div>
</div>
<p>GVT-g core logic will call these APIs through wrap functions with prefix
<code class="docutils literal notranslate"><span class="pre">intel_gvt_hypervisor_</span></code> to request specific services from hypervisor through
VHM.</p>
<p>This section describes the wrap functions:</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_host_init">
int <code class="descname">intel_gvt_hypervisor_host_init</code><span class="sig-paren">(</span>struct device *<em>&nbsp;dev</em>, void *<em>&nbsp;gvt</em>, const void *<em>&nbsp;ops</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_host_init" title="Permalink to this definition">¶</a></dt>
<dd><p>init GVT-g host side</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>i915 device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">gvt</span></code></dt>
<dd>GVT device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">void</span> <span class="pre">*</span> <span class="pre">ops</span></code></dt>
<dd>intel_gvt_ops interface</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_host_exit">
void <code class="descname">intel_gvt_hypervisor_host_exit</code><span class="sig-paren">(</span>struct device *<em>&nbsp;dev</em>, void *<em>&nbsp;gvt</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_host_exit" title="Permalink to this definition">¶</a></dt>
<dd><p>exit GVT-g host side</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*</span> <span class="pre">dev</span></code></dt>
<dd>i915 device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">gvt</span></code></dt>
<dd>GVT device</dd>
</dl>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_attach_vgpu">
int <code class="descname">intel_gvt_hypervisor_attach_vgpu</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_attach_vgpu" title="Permalink to this definition">¶</a></dt>
<dd><p>call hypervisor to initialize vGPU related stuffs inside hypervisor.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_detach_vgpu">
void <code class="descname">intel_gvt_hypervisor_detach_vgpu</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_detach_vgpu" title="Permalink to this definition">¶</a></dt>
<dd><p>call hypervisor to release vGPU related stuffs inside hypervisor.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_inject_msi">
int <code class="descname">intel_gvt_hypervisor_inject_msi</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_inject_msi" title="Permalink to this definition">¶</a></dt>
<dd><p>inject a MSI interrupt into vGPU</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_virt_to_mfn">
unsigned long <code class="descname">intel_gvt_hypervisor_virt_to_mfn</code><span class="sig-paren">(</span>void *<em>&nbsp;p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_virt_to_mfn" title="Permalink to this definition">¶</a></dt>
<dd><p>translate a host VA into MFN</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">p</span></code></dt>
<dd>host kernel virtual address</dd>
</dl>
<p><strong>Return</strong></p>
<p>MFN on success, INTEL_GVT_INVALID_ADDR if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_set_wp_page">
int <code class="descname">intel_gvt_hypervisor_set_wp_page</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, struct intel_vgpu_guest_page *<em>&nbsp;p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_set_wp_page" title="Permalink to this definition">¶</a></dt>
<dd><p>set a guest page to write-protected</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu_guest_page</span> <span class="pre">*</span> <span class="pre">p</span></code></dt>
<dd>intel_vgpu_guest_page</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_unset_wp_page">
int <code class="descname">intel_gvt_hypervisor_unset_wp_page</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, struct intel_vgpu_guest_page *<em>&nbsp;p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_unset_wp_page" title="Permalink to this definition">¶</a></dt>
<dd><p>remove the write-protection of a guest page</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu_guest_page</span> <span class="pre">*</span> <span class="pre">p</span></code></dt>
<dd>intel_vgpu_guest_page</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_read_gpa">
int <code class="descname">intel_gvt_hypervisor_read_gpa</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, unsigned long<em>&nbsp;gpa</em>, void *<em>&nbsp;buf</em>, unsigned long<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_read_gpa" title="Permalink to this definition">¶</a></dt>
<dd><p>copy data from GPA to host data buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">gpa</span></code></dt>
<dd>guest physical address</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>host data buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">len</span></code></dt>
<dd>data length</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_write_gpa">
int <code class="descname">intel_gvt_hypervisor_write_gpa</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, unsigned long<em>&nbsp;gpa</em>, void *<em>&nbsp;buf</em>, unsigned long<em>&nbsp;len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_write_gpa" title="Permalink to this definition">¶</a></dt>
<dd><p>copy data from host data buffer to GPA</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">gpa</span></code></dt>
<dd>guest physical address</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">buf</span></code></dt>
<dd>host data buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">len</span></code></dt>
<dd>data length</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_gfn_to_mfn">
unsigned long <code class="descname">intel_gvt_hypervisor_gfn_to_mfn</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, unsigned long<em>&nbsp;gfn</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_gfn_to_mfn" title="Permalink to this definition">¶</a></dt>
<dd><p>translate a GFN to MFN</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">gfn</span></code></dt>
<dd>guest pfn</dd>
</dl>
<p><strong>Return</strong></p>
<p>MFN on success, INTEL_GVT_INVALID_ADDR if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_map_gfn_to_mfn">
int <code class="descname">intel_gvt_hypervisor_map_gfn_to_mfn</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, unsigned long<em>&nbsp;gfn</em>, unsigned long<em>&nbsp;mfn</em>, unsigned int<em>&nbsp;nr</em>, bool<em>&nbsp;map</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_map_gfn_to_mfn" title="Permalink to this definition">¶</a></dt>
<dd><p>map a GFN region to MFN</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">gfn</span></code></dt>
<dd>guest PFN</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">mfn</span></code></dt>
<dd>host PFN</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">nr</span></code></dt>
<dd>amount of PFNs</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">map</span></code></dt>
<dd>map or unmap</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_set_trap_area">
int <code class="descname">intel_gvt_hypervisor_set_trap_area</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, u64<em>&nbsp;start</em>, u64<em>&nbsp;end</em>, bool<em>&nbsp;map</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_set_trap_area" title="Permalink to this definition">¶</a></dt>
<dd><p>Trap a guest PA region</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">start</span></code></dt>
<dd>the beginning of the guest physical address region</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">end</span></code></dt>
<dd>the end of the guest physical address region</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">map</span></code></dt>
<dd>map or unmap</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_set_pvmmio">
int <code class="descname">intel_gvt_hypervisor_set_pvmmio</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, u64<em>&nbsp;start</em>, u64<em>&nbsp;end</em>, bool<em>&nbsp;map</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_set_pvmmio" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the pvmmio area</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">start</span></code></dt>
<dd>the beginning of the guest physical address region</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">end</span></code></dt>
<dd>the end of the guest physical address region</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">map</span></code></dt>
<dd>map or unmap</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_pause_domain">
int <code class="descname">intel_gvt_hypervisor_pause_domain</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_pause_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>Pause a domain</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_unpause_domain">
int <code class="descname">intel_gvt_hypervisor_unpause_domain</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_unpause_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpause a domain</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed</p>
<dl class="function">
<dt id="c.intel_gvt_hypervisor_dom0_ready">
int <code class="descname">intel_gvt_hypervisor_dom0_ready</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_hypervisor_dom0_ready" title="Permalink to this definition">¶</a></dt>
<dd><p>Signal Dom 0 is ready for Dom U</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">void</span></code></dt>
<dd>no arguments</dd>
</dl>
<p><strong>Description</strong></p>
<p>It’s to raise a uevent to notify Dom 0 is ready to start a Dom U, so that
Dom U can be started as early as possible</p>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed</p>
</div>
<div class="section" id="gvt-g-intel-gvt-ops-interface">
<span id="intel-gvt-ops-interface"></span><h2>GVT-g intel_gvt_ops interface<a class="headerlink" href="#gvt-g-intel-gvt-ops-interface" title="Permalink to this headline">¶</a></h2>
<p>This section contains APIs for GVT-g intel_gvt_ops interface. Sources are found
in the <a class="reference external" href="https://github.com/projectacrn/acrn-kernel/">ACRN kernel GitHub repo</a></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">intel_gvt_ops</span> <span class="n">intel_gvt_ops</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">emulate_cfg_read</span> <span class="o">=</span> <span class="n">intel_vgpu_emulate_cfg_read</span><span class="p">,</span>
        <span class="p">.</span><span class="n">emulate_cfg_write</span> <span class="o">=</span> <span class="n">intel_vgpu_emulate_cfg_write</span><span class="p">,</span>
        <span class="p">.</span><span class="n">emulate_mmio_read</span> <span class="o">=</span> <span class="n">intel_vgpu_emulate_mmio_read</span><span class="p">,</span>
        <span class="p">.</span><span class="n">emulate_mmio_write</span> <span class="o">=</span> <span class="n">intel_vgpu_emulate_mmio_write</span><span class="p">,</span>
        <span class="p">.</span><span class="n">vgpu_create</span> <span class="o">=</span> <span class="n">intel_gvt_create_vgpu</span><span class="p">,</span>
        <span class="p">.</span><span class="n">vgpu_destroy</span> <span class="o">=</span> <span class="n">intel_gvt_destroy_vgpu</span><span class="p">,</span>
        <span class="p">.</span><span class="n">vgpu_reset</span> <span class="o">=</span> <span class="n">intel_gvt_reset_vgpu</span><span class="p">,</span>
        <span class="p">.</span><span class="n">vgpu_activate</span> <span class="o">=</span> <span class="n">intel_gvt_activate_vgpu</span><span class="p">,</span>
        <span class="p">.</span><span class="n">vgpu_deactivate</span> <span class="o">=</span> <span class="n">intel_gvt_deactivate_vgpu</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<dl class="function">
<dt id="c.intel_vgpu_emulate_cfg_read">
int <code class="descname">intel_vgpu_emulate_cfg_read</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, unsigned int<em>&nbsp;offset</em>, void *<em>&nbsp;p_data</em>, unsigned int<em>&nbsp;bytes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_vgpu_emulate_cfg_read" title="Permalink to this definition">¶</a></dt>
<dd><p>emulate vGPU configuration space read</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">offset</span></code></dt>
<dd>offset into the PCI configuration space</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">p_data</span></code></dt>
<dd>data buffer read from vGPU’s emulated configure space</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">bytes</span></code></dt>
<dd>size of data to read in bytes</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_vgpu_emulate_cfg_write">
int <code class="descname">intel_vgpu_emulate_cfg_write</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, unsigned int<em>&nbsp;offset</em>, void *<em>&nbsp;p_data</em>, unsigned int<em>&nbsp;bytes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_vgpu_emulate_cfg_write" title="Permalink to this definition">¶</a></dt>
<dd><p>emulate vGPU configuration space write</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">offset</span></code></dt>
<dd>offset into the PCI configuration space</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">p_data</span></code></dt>
<dd>data buffer write to vGPU’s emulated configure space</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">bytes</span></code></dt>
<dd>size of data to write in bytes</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed.</p>
<dl class="function">
<dt id="c.intel_vgpu_emulate_mmio_read">
int <code class="descname">intel_vgpu_emulate_mmio_read</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, uint64_t<em>&nbsp;pa</em>, void *<em>&nbsp;p_data</em>, unsigned int<em>&nbsp;bytes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_vgpu_emulate_mmio_read" title="Permalink to this definition">¶</a></dt>
<dd><p>emulate MMIO read</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">pa</span></code></dt>
<dd>guest physical address</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">p_data</span></code></dt>
<dd>data return buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">bytes</span></code></dt>
<dd>access data length</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed</p>
<dl class="function">
<dt id="c.intel_vgpu_emulate_mmio_write">
int <code class="descname">intel_vgpu_emulate_mmio_write</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em>, uint64_t<em>&nbsp;pa</em>, void *<em>&nbsp;p_data</em>, unsigned int<em>&nbsp;bytes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_vgpu_emulate_mmio_write" title="Permalink to this definition">¶</a></dt>
<dd><p>emulate MMIO write</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>a vGPU</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">pa</span></code></dt>
<dd>guest physical address</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span> <span class="pre">p_data</span></code></dt>
<dd>write data buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">bytes</span></code></dt>
<dd>access data length</dd>
</dl>
<p><strong>Return</strong></p>
<p>Zero on success, negative error code if failed</p>
<dl class="function">
<dt id="c.intel_gvt_activate_vgpu">
void <code class="descname">intel_gvt_activate_vgpu</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_activate_vgpu" title="Permalink to this definition">¶</a></dt>
<dd><p>activate a virtual GPU</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>virtual GPU</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called when user wants to activate a virtual GPU.</p>
<dl class="function">
<dt id="c.intel_gvt_deactivate_vgpu">
void <code class="descname">intel_gvt_deactivate_vgpu</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_deactivate_vgpu" title="Permalink to this definition">¶</a></dt>
<dd><p>deactivate a virtual GPU</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>virtual GPU</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called when user wants to deactivate a virtual GPU.
All virtual GPU runtime information will be destroyed.</p>
<dl class="function">
<dt id="c.intel_gvt_destroy_vgpu">
void <code class="descname">intel_gvt_destroy_vgpu</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_destroy_vgpu" title="Permalink to this definition">¶</a></dt>
<dd><p>destroy a virtual GPU</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>virtual GPU</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called when user wants to destroy a virtual GPU.</p>
<dl class="function">
<dt id="c.intel_gvt_reset_vgpu">
void <code class="descname">intel_gvt_reset_vgpu</code><span class="sig-paren">(</span>struct intel_vgpu *<em>&nbsp;vgpu</em><span class="sig-paren">)</span><a class="headerlink" href="#c.intel_gvt_reset_vgpu" title="Permalink to this definition">¶</a></dt>
<dd><p>reset a virtual GPU (Function Level)</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">intel_vgpu</span> <span class="pre">*</span> <span class="pre">vgpu</span></code></dt>
<dd>virtual GPU</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is called when user wants to reset a virtual GPU.</p>
</div>
<div class="section" id="acrngt-sysfs-interface">
<span id="sysfs-interface"></span><h2>AcrnGT sysfs interface<a class="headerlink" href="#acrngt-sysfs-interface" title="Permalink to this headline">¶</a></h2>
<p>This section contains APIs for the AcrnGT sysfs interface. Sources are found
in the <a class="reference external" href="https://github.com/projectacrn/acrn-kernel/">ACRN kernel GitHub repo</a></p>
<div class="section" id="sysfs-nodes">
<h3>sysfs nodes<a class="headerlink" href="#sysfs-nodes" title="Permalink to this headline">¶</a></h3>
<p>In below examples all accesses to these interfaces are via bash command
<code class="docutils literal notranslate"><span class="pre">echo</span></code> or <code class="docutils literal notranslate"><span class="pre">cat</span></code>. This is a quick and easy way to get/control things. But
when these operations fails, it is impossible to get respective error code by
this way.</p>
<p>When accessing sysfs entries, people should use library functions such as
<code class="docutils literal notranslate"><span class="pre">read()</span></code> or <code class="docutils literal notranslate"><span class="pre">write()</span></code>.</p>
<p>On <strong>success</strong>, the returned value of <code class="docutils literal notranslate"><span class="pre">read()</span></code> or <code class="docutils literal notranslate"><span class="pre">write()</span></code> indicates how
many bytes have been transferred.  On <strong>error</strong>, the returned value is <code class="docutils literal notranslate"><span class="pre">-1</span></code>
and the global <code class="docutils literal notranslate"><span class="pre">errno</span></code> will be set appropriately. This is the only way to
figure out what kind of error occurs.</p>
<div class="section" id="sys-kernel-gvt">
<h4>/sys/kernel/gvt/<a class="headerlink" href="#sys-kernel-gvt" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">/sys/kernel/gvt/</span></code> class sub-directory belongs to AcrnGT and provides a
centralized sysfs interface for configuring vGPU properties.</p>
</div>
<div class="section" id="sys-kernel-gvt-control">
<h4>/sys/kernel/gvt/control/<a class="headerlink" href="#sys-kernel-gvt-control" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">/sys/kernel/gvt/control/</span></code> sub-directory contains all the necessary
switches for different purposes.</p>
</div>
<div class="section" id="sys-kernel-gvt-control-create-gvt-instance">
<h4>/sys/kernel/gvt/control/create_gvt_instance<a class="headerlink" href="#sys-kernel-gvt-control-create-gvt-instance" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">/sys/kernel/gvt/control/create_gvt_instance</span></code> node is used by ACRN-DM to
create/destroy a vGPU instance.</p>
</div>
<div class="section" id="sys-kernel-gvt-vmn">
<h4>/sys/kernel/gvt/vmN/<a class="headerlink" href="#sys-kernel-gvt-vmn" title="Permalink to this headline">¶</a></h4>
<p>After a VM is created, a new sub-directory <code class="docutils literal notranslate"><span class="pre">vmN</span></code> (“N” is the VM id) will be
created.</p>
</div>
<div class="section" id="sys-kernel-gvt-vmn-vgpu-id">
<h4>/sys/kernel/gvt/vmN/vgpu_id<a class="headerlink" href="#sys-kernel-gvt-vmn-vgpu-id" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">/sys/kernel/gvt/vmN/vgpu_id</span></code> node is to get vGPU id from VM which id is
N.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Project ACRN.
      Last updated on Sep 24, 2018.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Project ACRN</span>
      v: v0.2
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/latest/">latest</a></dd>
        
          <dd><a href="/0.2/">0.2</a></dd>
        
          <dd><a href="/0.1/">0.1</a></dd>
        
      </dl>
      <dl>
        <dt>On projectacrn.org</dt>
          <dd>
            <a href="https://www.projectacrn.org/">Project Home</a>
          </dd>
          <dd>
            <a href="https://github.com/projectacrn/acrn-hypervisor/wiki">Wiki</a>
          </dd>
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v 0.2-unstable',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/acrn-custom.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>